var Te=Object.defineProperty;var ke=(t,e,n)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Q=(t,e,n)=>(ke(t,typeof e!="symbol"?e+"":e,n),n);import{J as ge,S as Le,i as Ie,s as we,k as m,q as M,a as V,l as h,m as L,r as U,h as s,c as S,b as a,G as d,K as $,L as y,H as fe,M as Ae,I as ae,N as Ne,u as Ve,O as Y}from"../chunks/index.981b2948.js";import{w as be}from"../chunks/index.a9d476b4.js";const Se=5,Oe=500;let ve={retryCount:5,retryBackoffTime:100};function ye(){return ve}function Me(t){ve=t}const K=new Map;function Ue(t,e){const n=K.get(t);if(n)return ie(t),n.store;console.log(`creating: ${t}`);const i=Be(e);return K.set(t,i),te(i,e),K.get(t).store}function te(t,e,n=0){console.log("executing fn"),n<Se&&e().then(i=>Re(t,i)).catch(()=>{t.store.update(i=>(i.isError=!0,i)),n=n+1,console.log(`retry: ${n}`),setTimeout(()=>{te(t,e,n)},n*Oe)})}function ie(t){if(console.log(`refreshing: ${t}`),!K.has(t))return;const e=K.get(t);e.store.update(n=>(n.isLoading=!0,n)),te(e,e.function)}class Pe{constructor(e,n,i){Q(this,"key");Q(this,"fn");Q(this,"optimisticMutateFn");Q(this,"isLoading",!1);Q(this,"isError",!1);this.key=e,this.fn=n,this.optimisticMutateFn=i}mutate(){this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const e=K.get(this.key),n=ge(e.store).data,i=JSON.parse(JSON.stringify(n));if(this.optimisticMutateFn&&n){const o=this.optimisticMutateFn(n);e.store.update(u=>(u.data=o,u))}this.fn().then(()=>{e&&ie(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&e.store.update(o=>(o.data=i,o))}).finally(()=>{this.isLoading=!1})}}function Ce(t,e,n){const i=new Pe(t,e,n);return be(i)}function ne(t,e,n){console.log(`mutating ${t}`);const i=K.get(t),o=ge(i.store).data,u=JSON.parse(JSON.stringify(o));if(n&&o){const r=n(o);i.store.update(p=>(p.data=r,p))}e().then(()=>{i&&ie(t)}).catch(()=>{console.log(`error mutating: ${t}`),n&&i.store.update(r=>(r.data=u,r))})}function Be(t){return{function:t,store:be({isLoading:!0,isError:!1,data:void 0})}}function Re(t,e){return t.store.update(n=>(n.isLoading=!1,n.isError=!1,n.data=e,n)),t}async function Z(t){return new Promise(e=>setTimeout(e,t*1e3))}let R=[],G={failureRate:.5,sleepTime:.25};function Fe(){return G}function Je(t){G=t}async function De(){if(await Z(G.sleepTime),x())throw new Error("unable to get");return console.log("service: get"),console.log(R),JSON.parse(JSON.stringify(R))}async function Ee(){if(await Z(G.sleepTime),x())throw new Error("unable to add");return R.push(R.length.toString()),console.log("service: add"),console.log(R),!0}async function qe(){if(await Z(G.sleepTime),x())throw new Error("unable to deleteAll");return R=[],console.log("service: deleteAll"),console.log(R),!0}async function $e(t){if(await Z(G.sleepTime),x())throw new Error("unable to deleteItem");const e=R.findIndex(n=>n===t);return e!==-1&&R.splice(e,1),console.log("service: deleteOne"),console.log(R),!0}function x(){return console.log(G.failureRate),Math.random()<G.failureRate}function Ge(){return Ue("todos",De)}function He(){return Ce("todos",Ee,t=>{if(t)return t.push(t==null?void 0:t.length.toString()),t})}function Ke(){ne("todos",Ee,t=>{if(t)return t.push(t==null?void 0:t.length.toString()),t})}function Qe(t){ne("todos",async()=>await $e(t))}function je(){ne("todos",qe)}function ce(t,e,n){const i=t.slice();return i[19]=e[n],i}function de(t){let e,n;return{c(){e=m("p"),n=M("Adder Loading")},l(i){e=h(i,"P",{});var o=L(e);n=U(o,"Adder Loading"),o.forEach(s)},m(i,o){a(i,e,o),d(e,n)},d(i){i&&s(e)}}}function pe(t){let e,n;return{c(){e=m("p"),n=M("Error Adding")},l(i){e=h(i,"P",{});var o=L(e);n=U(o,"Error Adding"),o.forEach(s)},m(i,o){a(i,e,o),d(e,n)},d(i){i&&s(e)}}}function ze(t){let e,n;return{c(){e=m("p"),n=M("Finished")},l(i){e=h(i,"P",{});var o=L(e);n=U(o,"Finished"),o.forEach(s)},m(i,o){a(i,e,o),d(e,n)},d(i){i&&s(e)}}}function We(t){let e,n;return{c(){e=m("p"),n=M("Loading")},l(i){e=h(i,"P",{});var o=L(e);n=U(o,"Loading"),o.forEach(s)},m(i,o){a(i,e,o),d(e,n)},d(i){i&&s(e)}}}function _e(t){let e,n;return{c(){e=m("p"),n=M("Error Loading")},l(i){e=h(i,"P",{});var o=L(e);n=U(o,"Error Loading"),o.forEach(s)},m(i,o){a(i,e,o),d(e,n)},d(i){i&&s(e)}}}function me(t){let e,n=t[5].data,i=[];for(let o=0;o<n.length;o+=1)i[o]=he(ce(t,n,o));return{c(){e=m("ul");for(let o=0;o<i.length;o+=1)i[o].c()},l(o){e=h(o,"UL",{});var u=L(e);for(let r=0;r<i.length;r+=1)i[r].l(u);u.forEach(s)},m(o,u){a(o,e,u);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null)},p(o,u){if(u&32){n=o[5].data;let r;for(r=0;r<n.length;r+=1){const p=ce(o,n,r);i[r]?i[r].p(p,u):(i[r]=he(p),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(o){o&&s(e),Ne(i,o)}}}function he(t){let e,n,i=t[19]+"",o,u,r,p,I,_,O,P,v,C;function w(){return t[16](t[19])}return{c(){e=m("div"),n=m("li"),o=M(i),u=V(),r=m("button"),p=M("info"),I=V(),_=m("button"),O=M("delete"),P=V()},l(A){e=h(A,"DIV",{});var c=L(e);n=h(c,"LI",{});var F=L(n);o=U(F,i),F.forEach(s),u=S(c),r=h(c,"BUTTON",{});var N=L(r);p=U(N,"info"),N.forEach(s),I=S(c),_=h(c,"BUTTON",{});var J=L(_);O=U(J,"delete"),J.forEach(s),P=S(c),c.forEach(s)},m(A,c){a(A,e,c),d(e,n),d(n,o),d(e,u),d(e,r),d(r,p),d(e,I),d(e,_),d(_,O),d(e,P),v||(C=y(_,"click",w),v=!0)},p(A,c){t=A,c&32&&i!==(i=t[19]+"")&&Ve(o,i)},d(A){A&&s(e),v=!1,C()}}}function Xe(t){let e,n,i,o,u,r,p,I,_,O,P,v,C,w,A,c,F,N,J,g,j,B,z,W,H,ee,le,E=t[4].isError&&de(),T=t[4].isError&&pe();function oe(l,f){return l[5].isLoading?We:ze}let X=oe(t),D=X(t),k=t[5].isError&&_e(),b=t[5].data&&t[5].data.length>0&&me(t);return{c(){e=m("button"),n=M("Add Item"),o=V(),u=m("button"),r=M("Add Item 2"),I=V(),_=m("button"),O=M("Clear All"),P=V(),v=m("input"),C=V(),w=m("input"),A=V(),c=m("input"),F=V(),N=m("input"),J=V(),g=m("div"),E&&E.c(),j=V(),T&&T.c(),B=V(),D.c(),z=V(),k&&k.c(),W=V(),H=m("div"),b&&b.c(),this.h()},l(l){e=h(l,"BUTTON",{});var f=L(e);n=U(f,"Add Item"),f.forEach(s),o=S(l),u=h(l,"BUTTON",{});var re=L(u);r=U(re,"Add Item 2"),re.forEach(s),I=S(l),_=h(l,"BUTTON",{});var se=L(_);O=U(se,"Clear All"),se.forEach(s),P=S(l),v=h(l,"INPUT",{}),C=S(l),w=h(l,"INPUT",{}),A=S(l),c=h(l,"INPUT",{}),F=S(l),N=h(l,"INPUT",{}),J=S(l),g=h(l,"DIV",{});var q=L(g);E&&E.l(q),j=S(q),T&&T.l(q),B=S(q),D.l(q),z=S(q),k&&k.l(q),q.forEach(s),W=S(l),H=h(l,"DIV",{});var ue=L(H);b&&b.l(ue),ue.forEach(s),this.h()},h(){e.disabled=i=t[5].isLoading,u.disabled=p=t[4].isLoading},m(l,f){a(l,e,f),d(e,n),a(l,o,f),a(l,u,f),d(u,r),a(l,I,f),a(l,_,f),d(_,O),a(l,P,f),a(l,v,f),$(v,t[0]),a(l,C,f),a(l,w,f),$(w,t[1]),a(l,A,f),a(l,c,f),$(c,t[2]),a(l,F,f),a(l,N,f),$(N,t[3]),a(l,J,f),a(l,g,f),E&&E.m(g,null),d(g,j),T&&T.m(g,null),d(g,B),D.m(g,null),d(g,z),k&&k.m(g,null),a(l,W,f),a(l,H,f),b&&b.m(H,null),ee||(le=[y(e,"click",t[10]),y(u,"click",t[11]),y(_,"click",je),y(v,"input",t[12]),y(v,"change",t[6]),y(w,"input",t[13]),y(w,"change",t[6]),y(c,"input",t[14]),y(c,"change",t[7]),y(N,"input",t[15]),y(N,"change",t[7])],ee=!0)},p(l,[f]){f&32&&i!==(i=l[5].isLoading)&&(e.disabled=i),f&16&&p!==(p=l[4].isLoading)&&(u.disabled=p),f&1&&v.value!==l[0]&&$(v,l[0]),f&2&&w.value!==l[1]&&$(w,l[1]),f&4&&c.value!==l[2]&&$(c,l[2]),f&8&&N.value!==l[3]&&$(N,l[3]),l[4].isError?E||(E=de(),E.c(),E.m(g,j)):E&&(E.d(1),E=null),l[4].isError?T||(T=pe(),T.c(),T.m(g,B)):T&&(T.d(1),T=null),X!==(X=oe(l))&&(D.d(1),D=X(l),D&&(D.c(),D.m(g,z))),l[5].isError?k||(k=_e(),k.c(),k.m(g,null)):k&&(k.d(1),k=null),l[5].data&&l[5].data.length>0?b?b.p(l,f):(b=me(l),b.c(),b.m(H,null)):b&&(b.d(1),b=null)},i:fe,o:fe,d(l){l&&s(e),l&&s(o),l&&s(u),l&&s(I),l&&s(_),l&&s(P),l&&s(v),l&&s(C),l&&s(w),l&&s(A),l&&s(c),l&&s(F),l&&s(N),l&&s(J),l&&s(g),E&&E.d(),T&&T.d(),D.d(),k&&k.d(),l&&s(W),l&&s(H),b&&b.d(),ee=!1,Ae(le)}}}function Ye(t,e,n){let i,o,u=Fe(),r=u.failureRate,p=u.sleepTime,I=ye(),_=I.retryCount,O=I.retryBackoffTime;function P(){u.failureRate=Y(r),u.sleepTime=Y(p),Je(u)}function v(){I.retryCount=Y(_),I.retryBackoffTime=Y(O),Me(I)}let C=Ge();ae(t,C,B=>n(5,o=B));let w=He();ae(t,w,B=>n(4,i=B));function A(){console.log("add button"),Ke()}function c(){i.mutate()}function F(){r=this.value,n(0,r)}function N(){p=this.value,n(1,p)}function J(){_=this.value,n(2,_)}function g(){O=this.value,n(3,O)}return[r,p,_,O,i,o,P,v,C,w,A,c,F,N,J,g,B=>Qe(B)]}class tt extends Le{constructor(e){super(),Ie(this,e,Ye,Xe,we,{})}}export{tt as component};
