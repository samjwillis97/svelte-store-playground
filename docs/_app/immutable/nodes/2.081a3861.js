var ut=Object.defineProperty;var ct=(t,e,r)=>e in t?ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var ue=(t,e,r)=>(ct(t,typeof e!="symbol"?e+"":e,r),r);import{J as nt,S as dt,i as ft,s as pt,k as u,q as y,a as m,l as c,m as d,r as w,h as i,c as _,n as a,b as z,G as n,K as Q,L as U,M as P,H as ze,N as ht,I as Xe,e as Ye,O as gt,u as vt}from"../chunks/index.826d2e79.js";import{w as at}from"../chunks/index.afe0d78c.js";const bt=5,mt=500;let it={retryCount:5,retryBackoffTime:100};function _t(){return it}function Et(t){it=t}const te=new Map;function yt(t,e){const r=te.get(t);if(r)return De(t),r.store;console.log(`creating: ${t}`);const l=kt(e);return te.set(t,l),Ne(l,e),te.get(t).store}function Ne(t,e,r=0){console.log("executing fn"),r<bt&&e().then(l=>It(t,l)).catch(()=>{t.store.update(l=>(l.isError=!0,l)),r=r+1,console.log(`retry: ${r}`),setTimeout(()=>{Ne(t,e,r)},r*mt)})}function De(t){if(console.log(`refreshing: ${t}`),!te.has(t))return;const e=te.get(t);e.store.update(r=>(r.isLoading=!0,r)),Ne(e,e.function)}class wt{constructor(e,r,l){ue(this,"key");ue(this,"fn");ue(this,"optimisticMutateFn");ue(this,"isLoading",!1);ue(this,"isError",!1);this.key=e,this.fn=r,this.optimisticMutateFn=l}mutate(){this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const e=te.get(this.key),r=nt(e.store).data,l=JSON.parse(JSON.stringify(r));if(this.optimisticMutateFn&&r){const o=this.optimisticMutateFn(r);e.store.update(f=>(f.data=o,f))}this.fn().then(()=>{e&&De(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&e.store.update(o=>(o.data=l,o))}).finally(()=>{this.isLoading=!1})}}function Tt(t,e,r){const l=new wt(t,e,r);return at(l)}function st(t,e,r){console.log(`mutating ${t}`);const l=te.get(t),o=nt(l.store).data,f=JSON.parse(JSON.stringify(o));if(r&&o){const s=r(o);l.store.update(p=>(p.data=s,p))}e().then(()=>{l&&De(t)}).catch(()=>{console.log(`error mutating: ${t}`),r&&l.store.update(s=>(s.data=f,s))})}function kt(t){return{function:t,store:at({isLoading:!0,isError:!1,data:void 0})}}function It(t,e){return t.store.update(r=>(r.isLoading=!1,r.isError=!1,r.data=e,r)),t}async function Ee(t){return new Promise(e=>setTimeout(e,t*1e3))}let W=[],le={failureRate:.5,sleepTime:.25};function Vt(){return le}function St(t){le=t}async function Lt(){if(await Ee(le.sleepTime),ye())throw new Error("unable to get");return console.log("service: get"),console.log(W),JSON.parse(JSON.stringify(W))}async function Rt(){if(await Ee(le.sleepTime),ye())throw new Error("unable to add");return W.push(W.length.toString()),console.log("service: add"),console.log(W),!0}async function Ct(){if(await Ee(le.sleepTime),ye())throw new Error("unable to deleteAll");return W=[],console.log("service: deleteAll"),console.log(W),!0}async function xt(t){if(await Ee(le.sleepTime),ye())throw new Error("unable to deleteItem");const e=W.findIndex(r=>r===t);return e!==-1&&W.splice(e,1),console.log("service: deleteOne"),console.log(W),!0}function ye(){return Math.random()<le.failureRate}function At(){return yt("todos",Lt)}function Ot(){return Tt("todos",Rt,t=>{if(t)return t.push(t==null?void 0:t.length.toString()),t})}function Bt(t){st("todos",async()=>await xt(t))}function Ft(){st("todos",Ct)}function Ze(t,e,r){const l=t.slice();return l[19]=e[r],l}function et(t){let e,r;return{c(){e=u("p"),r=y("Adder Loading,")},l(l){e=c(l,"P",{});var o=d(e);r=w(o,"Adder Loading,"),o.forEach(i)},m(l,o){z(l,e,o),n(e,r)},d(l){l&&i(e)}}}function tt(t){let e,r;return{c(){e=u("p"),r=y("Error Adding,")},l(l){e=c(l,"P",{});var o=d(e);r=w(o,"Error Adding,"),o.forEach(i)},m(l,o){z(l,e,o),n(e,r)},d(l){l&&i(e)}}}function Nt(t){let e,r;return{c(){e=u("p"),r=y("Waiting For Input...")},l(l){e=c(l,"P",{});var o=d(e);r=w(o,"Waiting For Input..."),o.forEach(i)},m(l,o){z(l,e,o),n(e,r)},d(l){l&&i(e)}}}function Dt(t){let e,r;return{c(){e=u("p"),r=y("Fetching Items,")},l(l){e=c(l,"P",{});var o=d(e);r=w(o,"Fetching Items,"),o.forEach(i)},m(l,o){z(l,e,o),n(e,r)},d(l){l&&i(e)}}}function lt(t){let e,r;return{c(){e=u("p"),r=y("Error Occured Fetching - Retrying")},l(l){e=c(l,"P",{});var o=d(e);r=w(o,"Error Occured Fetching - Retrying"),o.forEach(i)},m(l,o){z(l,e,o),n(e,r)},d(l){l&&i(e)}}}function rt(t){let e,r=t[5].data,l=[];for(let o=0;o<r.length;o+=1)l[o]=ot(Ze(t,r,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Ye()},l(o){for(let f=0;f<l.length;f+=1)l[f].l(o);e=Ye()},m(o,f){for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(o,f);z(o,e,f)},p(o,f){if(f&32){r=o[5].data;let s;for(s=0;s<r.length;s+=1){const p=Ze(o,r,s);l[s]?l[s].p(p,f):(l[s]=ot(p),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},d(o){gt(l,o),o&&i(e)}}}function ot(t){let e,r,l,o=t[19]+"",f,s,p,b,B,F,g,$,I,x,G;function X(){return t[15](t[19])}return{c(){e=u("div"),r=u("div"),l=u("p"),f=y(o),s=m(),p=u("div"),b=u("button"),B=y("info"),F=m(),g=u("button"),$=y("delete"),I=m(),this.h()},l(v){e=c(v,"DIV",{class:!0});var V=d(e);r=c(V,"DIV",{});var S=d(r);l=c(S,"P",{class:!0});var J=d(l);f=w(J,o),J.forEach(i),S.forEach(i),s=_(V),p=c(V,"DIV",{class:!0});var A=d(p);b=c(A,"BUTTON",{class:!0});var re=d(b);B=w(re,"info"),re.forEach(i),F=_(A),g=c(A,"BUTTON",{class:!0});var M=d(g);$=w(M,"delete"),M.forEach(i),A.forEach(i),I=_(V),V.forEach(i),this.h()},h(){a(l,"class","text-xl"),b.disabled=!0,a(b,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),a(g,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),a(p,"class","flex flex-row gap-2.5"),a(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(v,V){z(v,e,V),n(e,r),n(r,l),n(l,f),n(e,s),n(e,p),n(p,b),n(b,B),n(p,F),n(p,g),n(g,$),n(e,I),x||(G=U(g,"click",X),x=!0)},p(v,V){t=v,V&32&&o!==(o=t[19]+"")&&vt(f,o)},d(v){v&&i(e),x=!1,G()}}}function Pt(t){let e,r,l,o,f,s,p,b,B,F,g,$,I,x,G,X,v,V,S,J,A,re,M,Y,we,Te,N,ke,K,Z,Ie,Ve,D,Se,H,j,Le,de,Re,ee,Ce,xe,E,ce,Ae,Oe,fe,pe,he,Be,oe,Fe,Pe,L=t[4].isLoading&&et(),R=t[4].isError&&tt();function Me(h,k){if(h[5].isLoading)return Dt;if(!h[5].isError)return Nt}let ne=Me(t),O=ne&&ne(t),C=t[5].isError&&lt(),T=t[5].data&&t[5].data.length>0&&rt(t);return{c(){e=u("div"),r=u("div"),l=u("div"),o=u("h3"),f=y("Service Configuration"),s=m(),p=u("div"),b=u("label"),B=y("Failure Rate"),F=m(),g=u("input"),$=m(),I=u("div"),x=u("label"),G=y("Sleep Time (ms)"),X=m(),v=u("input"),V=m(),S=u("div"),J=u("h3"),A=y("Store Configuration"),re=m(),M=u("div"),Y=u("label"),we=y("Retry Count"),Te=m(),N=u("input"),ke=m(),K=u("div"),Z=u("label"),Ie=y("Retry Back Off (ms)"),Ve=m(),D=u("input"),Se=m(),H=u("div"),j=u("button"),Le=y("Add Item"),Re=m(),ee=u("button"),Ce=y("Clear All"),xe=m(),E=u("div"),ce=u("p"),Ae=y("Current Status:"),Oe=m(),L&&L.c(),fe=m(),R&&R.c(),pe=m(),O&&O.c(),he=m(),C&&C.c(),Be=m(),oe=u("div"),T&&T.c(),this.h()},l(h){e=c(h,"DIV",{class:!0});var k=d(e);r=c(k,"DIV",{class:!0});var ge=d(r);l=c(ge,"DIV",{class:!0});var ae=d(l);o=c(ae,"H3",{class:!0});var Ue=d(o);f=w(Ue,"Service Configuration"),Ue.forEach(i),s=_(ae),p=c(ae,"DIV",{class:!0});var ve=d(p);b=c(ve,"LABEL",{class:!0,for:!0});var Je=d(b);B=w(Je,"Failure Rate"),Je.forEach(i),F=_(ve),g=c(ve,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),ve.forEach(i),$=_(ae),I=c(ae,"DIV",{class:!0});var be=d(I);x=c(be,"LABEL",{class:!0,for:!0});var He=d(x);G=w(He,"Sleep Time (ms)"),He.forEach(i),X=_(be),v=c(be,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),be.forEach(i),ae.forEach(i),V=_(ge),S=c(ge,"DIV",{class:!0});var ie=d(S);J=c(ie,"H3",{class:!0});var qe=d(J);A=w(qe,"Store Configuration"),qe.forEach(i),re=_(ie),M=c(ie,"DIV",{class:!0});var me=d(M);Y=c(me,"LABEL",{class:!0,for:!0});var We=d(Y);we=w(We,"Retry Count"),We.forEach(i),Te=_(me),N=c(me,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),me.forEach(i),ke=_(ie),K=c(ie,"DIV",{class:!0});var _e=d(K);Z=c(_e,"LABEL",{class:!0,for:!0});var $e=d(Z);Ie=w($e,"Retry Back Off (ms)"),$e.forEach(i),Ve=_(_e),D=c(_e,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),_e.forEach(i),ie.forEach(i),ge.forEach(i),Se=_(k),H=c(k,"DIV",{class:!0});var se=d(H);j=c(se,"BUTTON",{class:!0});var je=d(j);Le=w(je,"Add Item"),je.forEach(i),Re=_(se),ee=c(se,"BUTTON",{class:!0});var Ge=d(ee);Ce=w(Ge,"Clear All"),Ge.forEach(i),xe=_(se),E=c(se,"DIV",{class:!0});var q=d(E);ce=c(q,"P",{});var Ke=d(ce);Ae=w(Ke,"Current Status:"),Ke.forEach(i),Oe=_(q),L&&L.l(q),fe=_(q),R&&R.l(q),pe=_(q),O&&O.l(q),he=_(q),C&&C.l(q),q.forEach(i),se.forEach(i),Be=_(k),oe=c(k,"DIV",{});var Qe=d(oe);T&&T.l(Qe),Qe.forEach(i),k.forEach(i),this.h()},h(){a(o,"class","text-xl"),a(b,"class","block text-gray-700 text-sm font-bold mb-2"),a(b,"for","serviceFailureRate"),a(g,"id","serviceFailureRate"),a(g,"placeholder","Failure Rate"),a(g,"type","number"),a(g,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),a(p,"class","w-full"),a(x,"class","block text-gray-700 text-sm font-bold mb-2"),a(x,"for","serviceSleepTime"),a(v,"id","serviceSleepTime"),a(v,"placeholder","Sleep Time"),a(v,"type","number"),a(v,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),a(I,"class","w-full"),a(l,"class","flex flex-col w-full gap-2.5"),a(J,"class","text-xl"),a(Y,"class","block text-gray-700 text-sm font-bold mb-2"),a(Y,"for","storeRetryCount"),a(N,"id","storeRetryCount"),a(N,"placeholder","Retry Count"),a(N,"type","number"),a(N,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),a(M,"class","w-full"),a(Z,"class","block text-gray-700 text-sm font-bold mb-2"),a(Z,"for","serviceSleepTime"),a(D,"id","storeRetryBackoff"),a(D,"placeholder","Back Off (ms)"),a(D,"type","number"),a(D,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),a(K,"class","w-full"),a(S,"class","flex flex-col w-full gap-2.5"),a(r,"class","flex flex-row gap-5 w-full"),j.disabled=de=t[4].isLoading,a(j,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),a(ee,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),a(E,"class","flex flex-row gap-1"),a(H,"class","flex flex-row gap-2.5 items-center w-full"),a(e,"class","flex flex-col gap-5 p-10 items-center")},m(h,k){z(h,e,k),n(e,r),n(r,l),n(l,o),n(o,f),n(l,s),n(l,p),n(p,b),n(b,B),n(p,F),n(p,g),Q(g,t[0]),n(l,$),n(l,I),n(I,x),n(x,G),n(I,X),n(I,v),Q(v,t[1]),n(r,V),n(r,S),n(S,J),n(J,A),n(S,re),n(S,M),n(M,Y),n(Y,we),n(M,Te),n(M,N),Q(N,t[2]),n(S,ke),n(S,K),n(K,Z),n(Z,Ie),n(K,Ve),n(K,D),Q(D,t[3]),n(e,Se),n(e,H),n(H,j),n(j,Le),n(H,Re),n(H,ee),n(ee,Ce),n(H,xe),n(H,E),n(E,ce),n(ce,Ae),n(E,Oe),L&&L.m(E,null),n(E,fe),R&&R.m(E,null),n(E,pe),O&&O.m(E,null),n(E,he),C&&C.m(E,null),n(e,Be),n(e,oe),T&&T.m(oe,null),Fe||(Pe=[U(g,"input",t[11]),U(g,"change",t[6]),U(v,"input",t[12]),U(v,"change",t[6]),U(N,"input",t[13]),U(N,"change",t[7]),U(D,"input",t[14]),U(D,"change",t[7]),U(j,"click",t[10]),U(ee,"click",Ft)],Fe=!0)},p(h,[k]){k&1&&P(g.value)!==h[0]&&Q(g,h[0]),k&2&&P(v.value)!==h[1]&&Q(v,h[1]),k&4&&P(N.value)!==h[2]&&Q(N,h[2]),k&8&&P(D.value)!==h[3]&&Q(D,h[3]),k&16&&de!==(de=h[4].isLoading)&&(j.disabled=de),h[4].isLoading?L||(L=et(),L.c(),L.m(E,fe)):L&&(L.d(1),L=null),h[4].isError?R||(R=tt(),R.c(),R.m(E,pe)):R&&(R.d(1),R=null),ne!==(ne=Me(h))&&(O&&O.d(1),O=ne&&ne(h),O&&(O.c(),O.m(E,he))),h[5].isError?C||(C=lt(),C.c(),C.m(E,null)):C&&(C.d(1),C=null),h[5].data&&h[5].data.length>0?T?T.p(h,k):(T=rt(h),T.c(),T.m(oe,null)):T&&(T.d(1),T=null)},i:ze,o:ze,d(h){h&&i(e),L&&L.d(),R&&R.d(),O&&O.d(),C&&C.d(),T&&T.d(),Fe=!1,ht(Pe)}}}function Mt(t,e,r){let l,o,f=Vt(),s=f.failureRate,p=f.sleepTime,b=_t(),B=b.retryCount,F=b.retryBackoffTime;function g(){f.failureRate=P(s),f.sleepTime=P(p),St(f)}function $(){b.retryCount=P(B),b.retryBackoffTime=P(F),Et(b)}let I=At();Xe(t,I,A=>r(5,o=A));let x=Ot();Xe(t,x,A=>r(4,l=A));function G(){l.mutate()}function X(){s=P(this.value),r(0,s)}function v(){p=P(this.value),r(1,p)}function V(){B=P(this.value),r(2,B)}function S(){F=P(this.value),r(3,F)}return[s,p,B,F,l,o,g,$,I,x,G,X,v,V,S,A=>Bt(A)]}class qt extends dt{constructor(e){super(),ft(this,e,Mt,Pt,pt,{})}}export{qt as component};
