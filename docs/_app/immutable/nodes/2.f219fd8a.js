var dt=Object.defineProperty;var ft=(t,e,l)=>e in t?dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l;var ce=(t,e,l)=>(ft(t,typeof e!="symbol"?e+"":e,l),l);import{J as it,S as pt,i as ht,s as gt,k as s,q as T,a as m,l as u,m as d,r as I,h as i,c as _,n,b as Z,G as a,K as G,L as M,M as U,H as Ze,N as vt,I as $e,e as et,O as bt,u as mt}from"../chunks/index.826d2e79.js";import{w as st}from"../chunks/index.afe0d78c.js";const _t=5,Et=500;let ut={retryCount:5,retryBackoffTime:100};function yt(){return ut}function wt(t){ut=t}const ae=new Map;function Tt(t,e){const l=ae.get(t);if(l)return Me(t),l.store;console.log(`creating: ${t}`);const r=Vt(e);return ae.set(t,r),Pe(r,e),ae.get(t).store}function Pe(t,e,l=0){console.log("executing fn"),l<_t&&e().then(r=>St(t,r)).catch(()=>{t.store.update(r=>(r.isError=!0,r)),l=l+1,console.log(`retry: ${l}`),setTimeout(()=>{Pe(t,e,l)},l*Et)})}function Me(t){if(console.log(`refreshing: ${t}`),!ae.has(t))return;const e=ae.get(t);e.store.update(l=>(l.isLoading=!0,l)),Pe(e,e.function)}class It{constructor(e,l,r){ce(this,"key");ce(this,"fn");ce(this,"optimisticMutateFn");ce(this,"isLoading",!1);ce(this,"isError",!1);this.key=e,this.fn=l,this.optimisticMutateFn=r}mutate(){this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const e=ae.get(this.key),l=it(e.store).data,r=JSON.parse(JSON.stringify(l));if(this.optimisticMutateFn&&l){const o=this.optimisticMutateFn(l);e.store.update(p=>(p.data=o,p))}this.fn().then(()=>{e&&Me(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&e.store.update(o=>(o.data=r,o))}).finally(()=>{this.isLoading=!1})}}function kt(t,e,l){const r=new It(t,e,l);return st(r)}function ct(t,e,l){console.log(`mutating ${t}`);const r=ae.get(t),o=it(r.store).data,p=JSON.parse(JSON.stringify(o));if(l&&o){const c=l(o);r.store.update(h=>(h.data=c,h))}e().then(()=>{r&&Me(t)}).catch(()=>{console.log(`error mutating: ${t}`),l&&r.store.update(c=>(c.data=p,c))})}function Vt(t){return{function:t,store:st({isLoading:!0,isError:!1,data:void 0})}}function St(t,e){return t.store.update(l=>(l.isLoading=!1,l.isError=!1,l.data=e,l)),t}async function ye(t){return new Promise(e=>setTimeout(e,t*1e3))}let K=[],ne={failureRate:.5,sleepTime:.25};function Lt(){return ne}function Rt(t){ne=t}async function Ct(){if(await ye(ne.sleepTime),we())throw new Error("unable to get");return console.log("service: get"),console.log(K),JSON.parse(JSON.stringify(K))}async function xt(){if(await ye(ne.sleepTime),we())throw new Error("unable to add");return K.push(K.length.toString()),console.log("service: add"),console.log(K),!0}async function At(){if(await ye(ne.sleepTime),we())throw new Error("unable to deleteAll");return K=[],console.log("service: deleteAll"),console.log(K),!0}async function Nt(t){if(await ye(ne.sleepTime),we())throw new Error("unable to deleteItem");const e=K.findIndex(l=>l===t);return e!==-1&&K.splice(e,1),console.log("service: deleteOne"),console.log(K),!0}function we(){return Math.random()<ne.failureRate}function Ot(){return Tt("todos",Ct)}function Bt(){return kt("todos",xt,t=>{if(t)return t.push(t==null?void 0:t.length.toString()),t})}function Ft(t){ct("todos",async()=>await Nt(t))}function Dt(){ct("todos",At)}function tt(t,e,l){const r=t.slice();return r[21]=e[l],r}function lt(t){let e,l;return{c(){e=s("p"),l=T("Adder Loading,")},l(r){e=u(r,"P",{});var o=d(e);l=I(o,"Adder Loading,"),o.forEach(i)},m(r,o){Z(r,e,o),a(e,l)},d(r){r&&i(e)}}}function rt(t){let e,l;return{c(){e=s("p"),l=T("Error Adding,")},l(r){e=u(r,"P",{});var o=d(e);l=I(o,"Error Adding,"),o.forEach(i)},m(r,o){Z(r,e,o),a(e,l)},d(r){r&&i(e)}}}function Pt(t){let e,l;return{c(){e=s("p"),l=T("Waiting For Input...")},l(r){e=u(r,"P",{});var o=d(e);l=I(o,"Waiting For Input..."),o.forEach(i)},m(r,o){Z(r,e,o),a(e,l)},d(r){r&&i(e)}}}function Mt(t){let e,l;return{c(){e=s("p"),l=T("Fetching Items,")},l(r){e=u(r,"P",{});var o=d(e);l=I(o,"Fetching Items,"),o.forEach(i)},m(r,o){Z(r,e,o),a(e,l)},d(r){r&&i(e)}}}function ot(t){let e,l;return{c(){e=s("p"),l=T("Error Occured Fetching - Retrying")},l(r){e=u(r,"P",{});var o=d(e);l=I(o,"Error Occured Fetching - Retrying"),o.forEach(i)},m(r,o){Z(r,e,o),a(e,l)},d(r){r&&i(e)}}}function at(t){let e,l=t[6].data,r=[];for(let o=0;o<l.length;o+=1)r[o]=nt(tt(t,l,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=et()},l(o){for(let p=0;p<r.length;p+=1)r[p].l(o);e=et()},m(o,p){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(o,p);Z(o,e,p)},p(o,p){if(p&64){l=o[6].data;let c;for(c=0;c<l.length;c+=1){const h=tt(o,l,c);r[c]?r[c].p(h,p):(r[c]=nt(h),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=l.length}},d(o){bt(r,o),o&&i(e)}}}function nt(t){let e,l,r,o=t[21]+"",p,c,h,b,O,B,g,Q,V,A,J;function $(){return t[17](t[21])}return{c(){e=s("div"),l=s("div"),r=s("p"),p=T(o),c=m(),h=s("div"),b=s("button"),O=T("info"),B=m(),g=s("button"),Q=T("delete"),V=m(),this.h()},l(v){e=u(v,"DIV",{class:!0});var S=d(e);l=u(S,"DIV",{class:!0});var L=d(l);r=u(L,"P",{class:!0});var H=d(r);p=I(H,o),H.forEach(i),L.forEach(i),c=_(S),h=u(S,"DIV",{class:!0});var q=d(h);b=u(q,"BUTTON",{class:!0});var ee=d(b);O=I(ee,"info"),ee.forEach(i),B=_(q),g=u(q,"BUTTON",{class:!0});var y=d(g);Q=I(y,"delete"),y.forEach(i),q.forEach(i),V=_(S),S.forEach(i),this.h()},h(){n(r,"class","text-xl"),n(l,"class","flex flex-row gap-2.5"),b.disabled=!0,n(b,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),n(g,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),n(h,"class","flex flex-row gap-2.5"),n(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(v,S){Z(v,e,S),a(e,l),a(l,r),a(r,p),a(e,c),a(e,h),a(h,b),a(b,O),a(h,B),a(h,g),a(g,Q),a(e,V),A||(J=M(g,"click",$),A=!0)},p(v,S){t=v,S&64&&o!==(o=t[21]+"")&&mt(p,o)},d(v){v&&i(e),A=!1,J()}}}function Ut(t){let e,l,r,o,p,c,h,b,O,B,g,Q,V,A,J,$,v,S,L,H,q,ee,y,te,Te,Ie,F,ke,X,le,Ve,Se,D,Le,P,W,Re,z,Ce,fe,xe,re,Ae,Ne,E,de,Oe,Be,pe,he,ge,Fe,oe,De,Ue,R=t[5].isLoading&&lt(),C=t[5].isError&&rt();function Je(f,w){if(f[6].isLoading)return Mt;if(!f[6].isError)return Pt}let ie=Je(t),N=ie&&ie(t),x=t[6].isError&&ot(),k=t[6].data&&t[6].data.length>0&&at(t);return{c(){e=s("div"),l=s("div"),r=s("div"),o=s("h3"),p=T("Service Configuration"),c=m(),h=s("div"),b=s("label"),O=T("Failure Rate"),B=m(),g=s("input"),Q=m(),V=s("div"),A=s("label"),J=T("Sleep Time (ms)"),$=m(),v=s("input"),S=m(),L=s("div"),H=s("h3"),q=T("Store Configuration"),ee=m(),y=s("div"),te=s("label"),Te=T("Retry Count"),Ie=m(),F=s("input"),ke=m(),X=s("div"),le=s("label"),Ve=T("Retry Back Off (ms)"),Se=m(),D=s("input"),Le=m(),P=s("div"),W=s("input"),Re=m(),z=s("button"),Ce=T("Add Item"),xe=m(),re=s("button"),Ae=T("Clear All"),Ne=m(),E=s("div"),de=s("p"),Oe=T("Current Status:"),Be=m(),R&&R.c(),pe=m(),C&&C.c(),he=m(),N&&N.c(),ge=m(),x&&x.c(),Fe=m(),oe=s("div"),k&&k.c(),this.h()},l(f){e=u(f,"DIV",{class:!0});var w=d(e);l=u(w,"DIV",{class:!0});var ve=d(l);r=u(ve,"DIV",{class:!0});var se=d(r);o=u(se,"H3",{class:!0});var He=d(o);p=I(He,"Service Configuration"),He.forEach(i),c=_(se),h=u(se,"DIV",{class:!0});var be=d(h);b=u(be,"LABEL",{class:!0,for:!0});var qe=d(b);O=I(qe,"Failure Rate"),qe.forEach(i),B=_(be),g=u(be,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),be.forEach(i),Q=_(se),V=u(se,"DIV",{class:!0});var me=d(V);A=u(me,"LABEL",{class:!0,for:!0});var We=d(A);J=I(We,"Sleep Time (ms)"),We.forEach(i),$=_(me),v=u(me,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),me.forEach(i),se.forEach(i),S=_(ve),L=u(ve,"DIV",{class:!0});var ue=d(L);H=u(ue,"H3",{class:!0});var je=d(H);q=I(je,"Store Configuration"),je.forEach(i),ee=_(ue),y=u(ue,"DIV",{class:!0});var _e=d(y);te=u(_e,"LABEL",{class:!0,for:!0});var Ge=d(te);Te=I(Ge,"Retry Count"),Ge.forEach(i),Ie=_(_e),F=u(_e,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),_e.forEach(i),ke=_(ue),X=u(ue,"DIV",{class:!0});var Ee=d(X);le=u(Ee,"LABEL",{class:!0,for:!0});var Ke=d(le);Ve=I(Ke,"Retry Back Off (ms)"),Ke.forEach(i),Se=_(Ee),D=u(Ee,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),Ee.forEach(i),ue.forEach(i),ve.forEach(i),Le=_(w),P=u(w,"DIV",{class:!0});var Y=d(P);W=u(Y,"INPUT",{placeholder:!0,type:!0,class:!0}),Re=_(Y),z=u(Y,"BUTTON",{class:!0});var Qe=d(z);Ce=I(Qe,"Add Item"),Qe.forEach(i),xe=_(Y),re=u(Y,"BUTTON",{class:!0});var ze=d(re);Ae=I(ze,"Clear All"),ze.forEach(i),Ne=_(Y),E=u(Y,"DIV",{class:!0});var j=d(E);de=u(j,"P",{});var Xe=d(de);Oe=I(Xe,"Current Status:"),Xe.forEach(i),Be=_(j),R&&R.l(j),pe=_(j),C&&C.l(j),he=_(j),N&&N.l(j),ge=_(j),x&&x.l(j),j.forEach(i),Y.forEach(i),Fe=_(w),oe=u(w,"DIV",{class:!0});var Ye=d(oe);k&&k.l(Ye),Ye.forEach(i),w.forEach(i),this.h()},h(){n(o,"class","text-xl"),n(b,"class","block text-gray-700 text-sm font-bold mb-2"),n(b,"for","serviceFailureRate"),n(g,"id","serviceFailureRate"),n(g,"placeholder","Failure Rate"),n(g,"type","number"),n(g,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(h,"class","w-full"),n(A,"class","block text-gray-700 text-sm font-bold mb-2"),n(A,"for","serviceSleepTime"),n(v,"id","serviceSleepTime"),n(v,"placeholder","Sleep Time"),n(v,"type","number"),n(v,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(V,"class","w-full"),n(r,"class","flex flex-col w-full gap-2.5"),n(H,"class","text-xl"),n(te,"class","block text-gray-700 text-sm font-bold mb-2"),n(te,"for","storeRetryCount"),n(F,"id","storeRetryCount"),n(F,"placeholder","Retry Count"),n(F,"type","number"),n(F,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(y,"class","w-full"),n(le,"class","block text-gray-700 text-sm font-bold mb-2"),n(le,"for","serviceSleepTime"),n(D,"id","storeRetryBackoff"),n(D,"placeholder","Back Off (ms)"),n(D,"type","number"),n(D,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(X,"class","w-full"),n(L,"class","flex flex-col w-full gap-2.5"),n(l,"class","flex flex-row gap-5 w-full"),n(W,"placeholder","Item"),n(W,"type","text"),n(W,"class","shadow appearance-none border rounded px-3 py-2 text-gray"),z.disabled=fe=t[5].isLoading||!t[4],n(z,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),n(re,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),n(E,"class","flex flex-row gap-1"),n(P,"class","flex flex-row gap-2.5 items-center w-full"),n(oe,"class","flex flex-col gap-2.5"),n(e,"class","flex flex-col gap-5 p-10 items-center")},m(f,w){Z(f,e,w),a(e,l),a(l,r),a(r,o),a(o,p),a(r,c),a(r,h),a(h,b),a(b,O),a(h,B),a(h,g),G(g,t[0]),a(r,Q),a(r,V),a(V,A),a(A,J),a(V,$),a(V,v),G(v,t[1]),a(l,S),a(l,L),a(L,H),a(H,q),a(L,ee),a(L,y),a(y,te),a(te,Te),a(y,Ie),a(y,F),G(F,t[2]),a(L,ke),a(L,X),a(X,le),a(le,Ve),a(X,Se),a(X,D),G(D,t[3]),a(e,Le),a(e,P),a(P,W),G(W,t[4]),a(P,Re),a(P,z),a(z,Ce),a(P,xe),a(P,re),a(re,Ae),a(P,Ne),a(P,E),a(E,de),a(de,Oe),a(E,Be),R&&R.m(E,null),a(E,pe),C&&C.m(E,null),a(E,he),N&&N.m(E,null),a(E,ge),x&&x.m(E,null),a(e,Fe),a(e,oe),k&&k.m(oe,null),De||(Ue=[M(g,"input",t[12]),M(g,"change",t[7]),M(v,"input",t[13]),M(v,"change",t[7]),M(F,"input",t[14]),M(F,"change",t[8]),M(D,"input",t[15]),M(D,"change",t[8]),M(W,"input",t[16]),M(z,"click",t[11]),M(re,"click",Dt)],De=!0)},p(f,[w]){w&1&&U(g.value)!==f[0]&&G(g,f[0]),w&2&&U(v.value)!==f[1]&&G(v,f[1]),w&4&&U(F.value)!==f[2]&&G(F,f[2]),w&8&&U(D.value)!==f[3]&&G(D,f[3]),w&16&&W.value!==f[4]&&G(W,f[4]),w&48&&fe!==(fe=f[5].isLoading||!f[4])&&(z.disabled=fe),f[5].isLoading?R||(R=lt(),R.c(),R.m(E,pe)):R&&(R.d(1),R=null),f[5].isError?C||(C=rt(),C.c(),C.m(E,he)):C&&(C.d(1),C=null),ie!==(ie=Je(f))&&(N&&N.d(1),N=ie&&ie(f),N&&(N.c(),N.m(E,ge))),f[6].isError?x||(x=ot(),x.c(),x.m(E,null)):x&&(x.d(1),x=null),f[6].data&&f[6].data.length>0?k?k.p(f,w):(k=at(f),k.c(),k.m(oe,null)):k&&(k.d(1),k=null)},i:Ze,o:Ze,d(f){f&&i(e),R&&R.d(),C&&C.d(),N&&N.d(),x&&x.d(),k&&k.d(),De=!1,vt(Ue)}}}function Jt(t,e,l){let r,o,p=Lt(),c=p.failureRate,h=p.sleepTime,b=yt(),O=b.retryCount,B=b.retryBackoffTime;function g(){p.failureRate=U(c),p.sleepTime=U(h),Rt(p)}function Q(){b.retryCount=U(O),b.retryBackoffTime=U(B),wt(b)}let V=Ot();$e(t,V,y=>l(6,o=y));let A=Bt();$e(t,A,y=>l(5,r=y));let J="";function $(){r.mutate(),l(4,J="")}function v(){c=U(this.value),l(0,c)}function S(){h=U(this.value),l(1,h)}function L(){O=U(this.value),l(2,O)}function H(){B=U(this.value),l(3,B)}function q(){J=this.value,l(4,J)}return[c,h,O,B,J,r,o,g,Q,V,A,$,v,S,L,H,q,y=>Ft(y)]}class jt extends pt{constructor(e){super(),ht(this,e,Jt,Ut,gt,{})}}export{jt as component};
