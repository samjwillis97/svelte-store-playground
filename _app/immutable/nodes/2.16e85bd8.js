var Oe=Object.defineProperty;var De=(l,e,t)=>e in l?Oe(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var ee=(l,e,t)=>(De(l,typeof e!="symbol"?e+"":e,t),t);import{a5 as Pe,S as se,i as ue,s as ce,k as h,q as x,a as I,l as g,m as v,r as S,h as d,c as L,n as c,b as J,J as a,a6 as K,K as D,a7 as U,O as re,L as ve,e as ae,M as ne,u as Ue,y as he,z as ge,A as me,g as j,d as X,f as Ve,B as _e,v as Fe,a8 as Je}from"../chunks/index.0b0bbde8.js";import{w as Me}from"../chunks/index.e8c34452.js";let ie={retryCount:5,retryBackoffTime:200};function qe(){return ie}function He(l){ie=l}const te=new Map;function Ke(l,e){const t=te.get(l);if(t)return Ne(l),t.store;console.log(`creating: ${l}`);const r=je(e);return te.set(l,r),be(r,e),te.get(l).store}function be(l,e,t=0){console.log("executing fn"),t<ie.retryBackoffTime&&e().then(r=>ze(l,r)).catch(()=>{l.store.update(r=>(r.isError=!0,r)),t=t+1,console.log(`retry: ${t}`),setTimeout(()=>{be(l,e,t)},t*ie.retryBackoffTime)})}function Ne(l){if(console.log(`refreshing: ${l}`),!te.has(l))return;const e=te.get(l);e.store.update(t=>(t.isLoading=!0,t)),be(e,e.function)}class We{constructor(e,t,r){ee(this,"key");ee(this,"fn");ee(this,"optimisticMutateFn");ee(this,"isLoading",!1);ee(this,"isError",!1);this.key=e,this.fn=t,this.optimisticMutateFn=r}mutate(...e){console.log(e),this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const t=te.get(this.key),r=Pe(t.store).data,o=JSON.parse(JSON.stringify(r));if(this.optimisticMutateFn&&r){const s=this.optimisticMutateFn(r,...e);t.store.update(n=>(n.data=s,n))}this.fn(...e).then(()=>{t&&Ne(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&t.store.update(s=>(s.data=o,s))}).finally(()=>{this.isLoading=!1})}}function ye(l,e,t){const r=new We(l,e,t);return Me(r)}function je(l){return{function:l,store:Me({isLoading:!0,isError:!1,data:void 0})}}function ze(l,e){return l.store.update(t=>(t.isLoading=!1,t.isError=!1,t.data=e,t)),l}async function fe(l){return new Promise(e=>setTimeout(e,l*1e3))}let z=[],Y={failureRate:.05,sleepTime:.25};function Qe(){return Y}function Ge(l){Y=l}async function Xe(){if(await fe(Y.sleepTime),de())throw new Error("unable to get");return console.log("service: get"),console.log(z),JSON.parse(JSON.stringify(z))}async function Ye(l){if(await fe(Y.sleepTime),de())throw new Error("unable to add");return z.push(l),console.log("service: add"),console.log(z),!0}async function Ze(){if(await fe(Y.sleepTime),de())throw new Error("unable to deleteAll");return z=[],console.log("service: deleteAll"),console.log(z),!0}async function et(l){if(await fe(Y.sleepTime),de())throw new Error("unable to deleteItem");const e=z.findIndex(t=>t===l);return e!==-1&&z.splice(e,1),console.log("service: deleteOne"),console.log(z),!0}function de(){return Math.random()<Y.failureRate}function tt(){return Ke("todos",Xe)}function rt(){return ye("todos",Ye,(l,e)=>(l.push(e),l))}function lt(){return ye("todos",et)}function ot(){return ye("todos",Ze)}function nt(l){let e,t,r,o,s,n,i,u,f,y,w,T,R,_,p,V,k;return{c(){e=h("div"),t=h("h3"),r=x("Service Configuration"),o=I(),s=h("div"),n=h("label"),i=x("Failure Rate"),u=I(),f=h("input"),y=I(),w=h("div"),T=h("label"),R=x("Sleep Time (ms)"),_=I(),p=h("input"),this.h()},l(m){e=g(m,"DIV",{class:!0});var b=v(e);t=g(b,"H3",{class:!0});var P=v(t);r=S(P,"Service Configuration"),P.forEach(d),o=L(b),s=g(b,"DIV",{class:!0});var F=v(s);n=g(F,"LABEL",{class:!0,for:!0});var q=v(n);i=S(q,"Failure Rate"),q.forEach(d),u=L(F),f=g(F,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),F.forEach(d),y=L(b),w=g(b,"DIV",{class:!0});var M=v(w);T=g(M,"LABEL",{class:!0,for:!0});var W=v(T);R=S(W,"Sleep Time (ms)"),W.forEach(d),_=L(M),p=g(M,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),M.forEach(d),b.forEach(d),this.h()},h(){c(t,"class","text-xl"),c(n,"class","block text-gray-700 text-sm font-bold mb-2"),c(n,"for","serviceFailureRate"),c(f,"id","serviceFailureRate"),c(f,"placeholder","Failure Rate"),c(f,"type","number"),c(f,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(s,"class","w-full"),c(T,"class","block text-gray-700 text-sm font-bold mb-2"),c(T,"for","serviceSleepTime"),c(p,"id","serviceSleepTime"),c(p,"placeholder","Sleep Time"),c(p,"type","number"),c(p,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(w,"class","w-full"),c(e,"class","flex flex-col w-full gap-2.5")},m(m,b){J(m,e,b),a(e,t),a(t,r),a(e,o),a(e,s),a(s,n),a(n,i),a(s,u),a(s,f),K(f,l[0]),a(e,y),a(e,w),a(w,T),a(T,R),a(w,_),a(w,p),K(p,l[1]),V||(k=[D(f,"input",l[3]),D(f,"change",l[2]),D(p,"input",l[4]),D(p,"change",l[2])],V=!0)},p(m,[b]){b&1&&U(f.value)!==m[0]&&K(f,m[0]),b&2&&U(p.value)!==m[1]&&K(p,m[1])},i:re,o:re,d(m){m&&d(e),V=!1,ve(k)}}}function at(l,e,t){let r=Qe(),o=r.failureRate,s=r.sleepTime;function n(){r.failureRate=U(o),r.sleepTime=U(s),Ge(r)}function i(){o=U(this.value),t(0,o)}function u(){s=U(this.value),t(1,s)}return[o,s,n,i,u]}class it extends se{constructor(e){super(),ue(this,e,at,nt,ce,{})}}function st(l){let e,t,r,o,s,n,i,u,f,y,w,T,R,_,p,V,k;return{c(){e=h("div"),t=h("h3"),r=x("Store Configuration"),o=I(),s=h("div"),n=h("label"),i=x("Retry Count"),u=I(),f=h("input"),y=I(),w=h("div"),T=h("label"),R=x("Retry Back Off (ms)"),_=I(),p=h("input"),this.h()},l(m){e=g(m,"DIV",{class:!0});var b=v(e);t=g(b,"H3",{class:!0});var P=v(t);r=S(P,"Store Configuration"),P.forEach(d),o=L(b),s=g(b,"DIV",{class:!0});var F=v(s);n=g(F,"LABEL",{class:!0,for:!0});var q=v(n);i=S(q,"Retry Count"),q.forEach(d),u=L(F),f=g(F,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),F.forEach(d),y=L(b),w=g(b,"DIV",{class:!0});var M=v(w);T=g(M,"LABEL",{class:!0,for:!0});var W=v(T);R=S(W,"Retry Back Off (ms)"),W.forEach(d),_=L(M),p=g(M,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),M.forEach(d),b.forEach(d),this.h()},h(){c(t,"class","text-xl"),c(n,"class","block text-gray-700 text-sm font-bold mb-2"),c(n,"for","storeRetryCount"),c(f,"id","storeRetryCount"),c(f,"placeholder","Retry Count"),c(f,"type","number"),c(f,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(s,"class","w-full"),c(T,"class","block text-gray-700 text-sm font-bold mb-2"),c(T,"for","serviceSleepTime"),c(p,"id","storeRetryBackoff"),c(p,"placeholder","Back Off (ms)"),c(p,"type","number"),c(p,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(w,"class","w-full"),c(e,"class","flex flex-col w-full gap-2.5")},m(m,b){J(m,e,b),a(e,t),a(t,r),a(e,o),a(e,s),a(s,n),a(n,i),a(s,u),a(s,f),K(f,l[0]),a(e,y),a(e,w),a(w,T),a(T,R),a(w,_),a(w,p),K(p,l[1]),V||(k=[D(f,"input",l[3]),D(f,"change",l[2]),D(p,"input",l[4]),D(p,"change",l[2])],V=!0)},p(m,[b]){b&1&&U(f.value)!==m[0]&&K(f,m[0]),b&2&&U(p.value)!==m[1]&&K(p,m[1])},i:re,o:re,d(m){m&&d(e),V=!1,ve(k)}}}function ut(l,e,t){let r=qe(),o=r.retryCount,s=r.retryBackoffTime;function n(){r.retryCount=U(o),r.retryBackoffTime=U(s),He(r)}function i(){o=U(this.value),t(0,o)}function u(){s=U(this.value),t(1,s)}return[o,s,n,i,u]}class ct extends se{constructor(e){super(),ue(this,e,ut,st,ce,{})}}function Le(l){let e,t,r,o,s,n,i,u,f,y,w,T,R;return{c(){e=h("div"),t=h("div"),r=h("p"),o=x(l[0]),s=I(),n=h("div"),i=h("button"),u=x("info"),f=I(),y=h("button"),w=x("delete"),this.h()},l(_){e=g(_,"DIV",{class:!0});var p=v(e);t=g(p,"DIV",{class:!0});var V=v(t);r=g(V,"P",{class:!0});var k=v(r);o=S(k,l[0]),k.forEach(d),V.forEach(d),s=L(p),n=g(p,"DIV",{class:!0});var m=v(n);i=g(m,"BUTTON",{class:!0});var b=v(i);u=S(b,"info"),b.forEach(d),f=L(m),y=g(m,"BUTTON",{class:!0});var P=v(y);w=S(P,"delete"),P.forEach(d),m.forEach(d),p.forEach(d),this.h()},h(){c(r,"class","text-xl"),c(t,"class","flex flex-row gap-2.5"),i.disabled=!0,c(i,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),c(y,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),c(n,"class","flex flex-row gap-2.5"),c(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(_,p){J(_,e,p),a(e,t),a(t,r),a(r,o),a(e,s),a(e,n),a(n,i),a(i,u),a(n,f),a(n,y),a(y,w),T||(R=D(y,"click",l[3]),T=!0)},p(_,p){p&1&&Ue(o,_[0])},d(_){_&&d(e),T=!1,R()}}}function ft(l){let e,t=l[0]&&Le(l);return{c(){t&&t.c(),e=ae()},l(r){t&&t.l(r),e=ae()},m(r,o){t&&t.m(r,o),J(r,e,o)},p(r,[o]){r[0]?t?t.p(r,o):(t=Le(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&d(e)}}}function dt(l,e,t){let r,{todo:o}=e,s=lt();ne(l,s,i=>t(1,r=i));const n=()=>r.mutate(o);return l.$$set=i=>{"todo"in i&&t(0,o=i.todo)},[o,r,s,n]}class pt extends se{constructor(e){super(),ue(this,e,dt,ft,ce,{todo:0})}}function xe(l,e,t){const r=l.slice();return r[11]=e[t],r}function Se(l){let e,t;return{c(){e=h("p"),t=x("Adder Loading,")},l(r){e=g(r,"P",{});var o=v(e);t=S(o,"Adder Loading,"),o.forEach(d)},m(r,o){J(r,e,o),a(e,t)},d(r){r&&d(e)}}}function Re(l){let e,t;return{c(){e=h("p"),t=x("Error Adding,")},l(r){e=g(r,"P",{});var o=v(e);t=S(o,"Error Adding,"),o.forEach(d)},m(r,o){J(r,e,o),a(e,t)},d(r){r&&d(e)}}}function ht(l){let e,t;return{c(){e=h("p"),t=x("Waiting For Input...")},l(r){e=g(r,"P",{});var o=v(e);t=S(o,"Waiting For Input..."),o.forEach(d)},m(r,o){J(r,e,o),a(e,t)},d(r){r&&d(e)}}}function gt(l){let e,t;return{c(){e=h("p"),t=x("Fetching Items,")},l(r){e=g(r,"P",{});var o=v(e);t=S(o,"Fetching Items,"),o.forEach(d)},m(r,o){J(r,e,o),a(e,t)},d(r){r&&d(e)}}}function Ce(l){let e,t;return{c(){e=h("p"),t=x("Error Occured Fetching - Retrying")},l(r){e=g(r,"P",{});var o=v(e);t=S(o,"Error Occured Fetching - Retrying"),o.forEach(d)},m(r,o){J(r,e,o),a(e,t)},d(r){r&&d(e)}}}function Ae(l){let e,t,r=l[3].data,o=[];for(let n=0;n<r.length;n+=1)o[n]=Be(xe(l,r,n));const s=n=>X(o[n],1,1,()=>{o[n]=null});return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=ae()},l(n){for(let i=0;i<o.length;i+=1)o[i].l(n);e=ae()},m(n,i){for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(n,i);J(n,e,i),t=!0},p(n,i){if(i&8){r=n[3].data;let u;for(u=0;u<r.length;u+=1){const f=xe(n,r,u);o[u]?(o[u].p(f,i),j(o[u],1)):(o[u]=Be(f),o[u].c(),j(o[u],1),o[u].m(e.parentNode,e))}for(Fe(),u=r.length;u<o.length;u+=1)s(u);Ve()}},i(n){if(!t){for(let i=0;i<r.length;i+=1)j(o[i]);t=!0}},o(n){o=o.filter(Boolean);for(let i=0;i<o.length;i+=1)X(o[i]);t=!1},d(n){Je(o,n),n&&d(e)}}}function Be(l){let e,t;return e=new pt({props:{todo:l[11]}}),{c(){he(e.$$.fragment)},l(r){ge(e.$$.fragment,r)},m(r,o){me(e,r,o),t=!0},p(r,o){const s={};o&8&&(s.todo=r[11]),e.$set(s)},i(r){t||(j(e.$$.fragment,r),t=!0)},o(r){X(e.$$.fragment,r),t=!1},d(r){_e(e,r)}}}function mt(l){let e,t,r,o,s,n,i,u,f,y,w,T,R,_,p,V,k,m,b,P,F,q,M,W,G,le,pe,Ee;r=new it({}),s=new ct({});let C=l[1].isLoading&&Se(),A=l[1].isError&&Re();function we(E,O){if(E[3].isLoading)return gt;if(!E[3].isError)return ht}let Z=we(l),N=Z&&Z(l),B=l[3].isError&&Ce(),$=l[3].data&&l[3].data.length>0&&Ae(l);return{c(){e=h("div"),t=h("div"),he(r.$$.fragment),o=I(),he(s.$$.fragment),n=I(),i=h("div"),u=h("input"),f=I(),y=h("button"),w=x("Add Item"),R=I(),_=h("button"),p=x("Clear All"),V=I(),k=h("div"),m=h("p"),b=x("Current Status:"),P=I(),C&&C.c(),F=I(),A&&A.c(),q=I(),N&&N.c(),M=I(),B&&B.c(),W=I(),G=h("div"),$&&$.c(),this.h()},l(E){e=g(E,"DIV",{class:!0});var O=v(e);t=g(O,"DIV",{class:!0});var oe=v(t);ge(r.$$.fragment,oe),o=L(oe),ge(s.$$.fragment,oe),oe.forEach(d),n=L(O),i=g(O,"DIV",{class:!0});var Q=v(i);u=g(Q,"INPUT",{placeholder:!0,type:!0,class:!0}),f=L(Q),y=g(Q,"BUTTON",{class:!0});var ke=v(y);w=S(ke,"Add Item"),ke.forEach(d),R=L(Q),_=g(Q,"BUTTON",{class:!0});var Te=v(_);p=S(Te,"Clear All"),Te.forEach(d),V=L(Q),k=g(Q,"DIV",{class:!0});var H=v(k);m=g(H,"P",{});var $e=v(m);b=S($e,"Current Status:"),$e.forEach(d),P=L(H),C&&C.l(H),F=L(H),A&&A.l(H),q=L(H),N&&N.l(H),M=L(H),B&&B.l(H),H.forEach(d),Q.forEach(d),W=L(O),G=g(O,"DIV",{class:!0});var Ie=v(G);$&&$.l(Ie),Ie.forEach(d),O.forEach(d),this.h()},h(){c(t,"class","flex flex-row gap-5 w-full"),c(u,"placeholder","Item"),c(u,"type","text"),c(u,"class","shadow appearance-none border rounded px-3 py-2 text-gray"),y.disabled=T=l[1].isLoading||!l[0],c(y,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),c(_,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),c(k,"class","flex flex-row gap-1"),c(i,"class","flex flex-row gap-2.5 items-center w-full"),c(G,"class","flex flex-col gap-2.5"),c(e,"class","flex flex-col gap-5 p-10 items-center")},m(E,O){J(E,e,O),a(e,t),me(r,t,null),a(t,o),me(s,t,null),a(e,n),a(e,i),a(i,u),K(u,l[0]),a(i,f),a(i,y),a(y,w),a(i,R),a(i,_),a(_,p),a(i,V),a(i,k),a(k,m),a(m,b),a(k,P),C&&C.m(k,null),a(k,F),A&&A.m(k,null),a(k,q),N&&N.m(k,null),a(k,M),B&&B.m(k,null),a(e,W),a(e,G),$&&$.m(G,null),le=!0,pe||(Ee=[D(u,"input",l[9]),D(u,"keyup",l[8]),D(y,"click",l[7]),D(_,"click",l[10])],pe=!0)},p(E,[O]){O&1&&u.value!==E[0]&&K(u,E[0]),(!le||O&3&&T!==(T=E[1].isLoading||!E[0]))&&(y.disabled=T),E[1].isLoading?C||(C=Se(),C.c(),C.m(k,F)):C&&(C.d(1),C=null),E[1].isError?A||(A=Re(),A.c(),A.m(k,q)):A&&(A.d(1),A=null),Z!==(Z=we(E))&&(N&&N.d(1),N=Z&&Z(E),N&&(N.c(),N.m(k,M))),E[3].isError?B||(B=Ce(),B.c(),B.m(k,null)):B&&(B.d(1),B=null),E[3].data&&E[3].data.length>0?$?($.p(E,O),O&8&&j($,1)):($=Ae(E),$.c(),j($,1),$.m(G,null)):$&&(Fe(),X($,1,1,()=>{$=null}),Ve())},i(E){le||(j(r.$$.fragment,E),j(s.$$.fragment,E),j($),le=!0)},o(E){X(r.$$.fragment,E),X(s.$$.fragment,E),X($),le=!1},d(E){E&&d(e),_e(r),_e(s),C&&C.d(),A&&A.d(),N&&N.d(),B&&B.d(),$&&$.d(),pe=!1,ve(Ee)}}}function _t(l,e,t){let r,o,s,n=tt();ne(l,n,_=>t(3,s=_));let i=rt();ne(l,i,_=>t(1,r=_));let u=ot();ne(l,u,_=>t(2,o=_));let f="";function y(){f&&(r.mutate(f),t(0,f=""))}function w(_){_.key==="Enter"&&y()}function T(){f=this.value,t(0,f)}return[f,r,o,s,n,i,u,y,w,T,()=>o.mutate()]}class Et extends se{constructor(e){super(),ue(this,e,_t,mt,ce,{})}}export{Et as component};
