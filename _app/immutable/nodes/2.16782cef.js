var Oe=Object.defineProperty;var Pe=(l,e,t)=>e in l?Oe(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var G=(l,e,t)=>(Pe(l,typeof e!="symbol"?e+"":e,t),t);import{a5 as Ue,S as ue,i as ce,s as fe,k as h,q as S,a as $,l as g,m as v,r as x,h as d,c as I,n as c,b as J,J as a,a6 as K,K as O,a7 as U,O as le,L as be,e as ie,M as ae,u as Je,y as ge,z as me,A as _e,g as j,d as Y,f as Be,B as ve,v as Ve,a8 as qe}from"../chunks/index.0b0bbde8.js";import{w as De}from"../chunks/index.e8c34452.js";import{t as te}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.2d687f9c.js";let se={retryCount:5,retryBackoffTime:200};function He(){return se}function Ke(l){se=l}const re=new Map;function We(l,e){const t=re.get(l);if(t)return Ne(l),t.store;console.log(`creating: ${l}`);const r=ze(e);return re.set(l,r),Ee(r,e),re.get(l).store}function Ee(l,e,t=0){console.log(`executing fn - try ${t}`),t<se.retryBackoffTime&&e().then(r=>Qe(l,r)).catch(()=>{l.store.update(r=>(r.isError=!0,r)),t=t+1,console.log(`retry: ${t}`),setTimeout(()=>{Ee(l,e,t)},t*se.retryBackoffTime)})}function Ne(l){if(console.log(`refreshing: ${l}`),!re.has(l))return;const e=re.get(l);e.store.update(t=>(t.isLoading=!0,t)),Ee(e,e.function)}class je{constructor(e,t,r){G(this,"key");G(this,"fn");G(this,"optimisticMutateFn");G(this,"onSuccessFn");G(this,"onErrorFn");G(this,"isLoading",!1);G(this,"isError",!1);this.key=e,this.fn=t,this.optimisticMutateFn=r==null?void 0:r.optimisticMutateFn,this.onSuccessFn=r==null?void 0:r.onSuccessFn,this.onErrorFn=r==null?void 0:r.onErrorFn}mutate(...e){this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const t=re.get(this.key),r=Ue(t.store).data,n=JSON.parse(JSON.stringify(r));if(this.optimisticMutateFn&&r){const s=this.optimisticMutateFn(r,...e);t.store.update(o=>(o.data=s,o))}this.fn(...e).then(()=>{t&&Ne(this.key),this.onSuccessFn&&this.onSuccessFn(...e)}).catch(()=>{this.isError=!0,console.log(`error mutating: ${this.key}`),this.onErrorFn&&this.onErrorFn(...e),this.optimisticMutateFn&&t.store.update(s=>(s.data=n,s))}).finally(()=>{this.isLoading=!1})}}function ye(l,e,t){const r=new je(l,e,t);return De(r)}function ze(l){return{function:l,store:De({isLoading:!0,isError:!1,data:void 0})}}function Qe(l,e){return l.store.update(t=>(t.isLoading=!1,t.isError=!1,t.data=e,t)),l}async function de(l){return new Promise(e=>setTimeout(e,l*1e3))}let z=[],Z={failureRate:.05,sleepTime:.25};function Ge(){return Z}function Xe(l){Z=l}async function Ye(){if(await de(Z.sleepTime),pe())throw new Error("unable to get");return console.log("service: get"),console.log(z),JSON.parse(JSON.stringify(z))}async function Ze(l){if(await de(Z.sleepTime),pe())throw new Error("unable to add");return z.push(l),console.log("service: add"),console.log(z),!0}async function et(){if(await de(Z.sleepTime),pe())throw new Error("unable to deleteAll");return z=[],console.log("service: deleteAll"),console.log(z),!0}async function tt(l){if(await de(Z.sleepTime),pe())throw new Error("unable to deleteItem");const e=z.findIndex(t=>t===l);return e!==-1&&z.splice(e,1),console.log("service: deleteOne"),console.log(z),!0}function pe(){return Math.random()<Z.failureRate}function rt(){return We("todos",Ye)}function lt(l){return ye("todos",async e=>{await Ze(e)},{optimisticMutateFn:(e,t)=>(e.push(t),e),...l})}function nt(l){return ye("todos",async e=>{await tt(e)},{optimisticMutateFn:(e,t)=>{const r=e.findIndex(n=>n===t);return r!==-1&&e.splice(r,1),e},...l})}function ot(l){return ye("todos",async()=>{await et()},{optimisticMutateFn:()=>[],...l})}function at(l){let e,t,r,n,s,o,i,u,f,E,w,T,A,m,p,R,F;return{c(){e=h("div"),t=h("h3"),r=S("Service Configuration"),n=$(),s=h("div"),o=h("label"),i=S("Failure Rate"),u=$(),f=h("input"),E=$(),w=h("div"),T=h("label"),A=S("Sleep Time (s)"),m=$(),p=h("input"),this.h()},l(_){e=g(_,"DIV",{class:!0});var b=v(e);t=g(b,"H3",{class:!0});var P=v(t);r=x(P,"Service Configuration"),P.forEach(d),n=I(b),s=g(b,"DIV",{class:!0});var B=v(s);o=g(B,"LABEL",{class:!0,for:!0});var q=v(o);i=x(q,"Failure Rate"),q.forEach(d),u=I(B),f=g(B,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),B.forEach(d),E=I(b),w=g(b,"DIV",{class:!0});var V=v(w);T=g(V,"LABEL",{class:!0,for:!0});var W=v(T);A=x(W,"Sleep Time (s)"),W.forEach(d),m=I(V),p=g(V,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),V.forEach(d),b.forEach(d),this.h()},h(){c(t,"class","text-xl"),c(o,"class","block text-gray-700 text-sm font-bold mb-2"),c(o,"for","serviceFailureRate"),c(f,"id","serviceFailureRate"),c(f,"placeholder","Failure Rate"),c(f,"type","number"),c(f,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(s,"class","w-full"),c(T,"class","block text-gray-700 text-sm font-bold mb-2"),c(T,"for","serviceSleepTime"),c(p,"id","serviceSleepTime"),c(p,"placeholder","Sleep Time"),c(p,"type","number"),c(p,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(w,"class","w-full"),c(e,"class","flex flex-col w-full gap-2.5")},m(_,b){J(_,e,b),a(e,t),a(t,r),a(e,n),a(e,s),a(s,o),a(o,i),a(s,u),a(s,f),K(f,l[0]),a(e,E),a(e,w),a(w,T),a(T,A),a(w,m),a(w,p),K(p,l[1]),R||(F=[O(f,"input",l[3]),O(f,"change",l[2]),O(p,"input",l[4]),O(p,"change",l[2])],R=!0)},p(_,[b]){b&1&&U(f.value)!==_[0]&&K(f,_[0]),b&2&&U(p.value)!==_[1]&&K(p,_[1])},i:le,o:le,d(_){_&&d(e),R=!1,be(F)}}}function it(l,e,t){let r=Ge(),n=r.failureRate,s=r.sleepTime;function o(){r.failureRate=U(n),r.sleepTime=U(s),Xe(r)}function i(){n=U(this.value),t(0,n)}function u(){s=U(this.value),t(1,s)}return[n,s,o,i,u]}class st extends ue{constructor(e){super(),ce(this,e,it,at,fe,{})}}function ut(l){let e,t,r,n,s,o,i,u,f,E,w,T,A,m,p,R,F;return{c(){e=h("div"),t=h("h3"),r=S("Store Configuration"),n=$(),s=h("div"),o=h("label"),i=S("Retry Count"),u=$(),f=h("input"),E=$(),w=h("div"),T=h("label"),A=S("Retry Back Off (ms)"),m=$(),p=h("input"),this.h()},l(_){e=g(_,"DIV",{class:!0});var b=v(e);t=g(b,"H3",{class:!0});var P=v(t);r=x(P,"Store Configuration"),P.forEach(d),n=I(b),s=g(b,"DIV",{class:!0});var B=v(s);o=g(B,"LABEL",{class:!0,for:!0});var q=v(o);i=x(q,"Retry Count"),q.forEach(d),u=I(B),f=g(B,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),B.forEach(d),E=I(b),w=g(b,"DIV",{class:!0});var V=v(w);T=g(V,"LABEL",{class:!0,for:!0});var W=v(T);A=x(W,"Retry Back Off (ms)"),W.forEach(d),m=I(V),p=g(V,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),V.forEach(d),b.forEach(d),this.h()},h(){c(t,"class","text-xl"),c(o,"class","block text-gray-700 text-sm font-bold mb-2"),c(o,"for","storeRetryCount"),c(f,"id","storeRetryCount"),c(f,"placeholder","Retry Count"),c(f,"type","number"),c(f,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(s,"class","w-full"),c(T,"class","block text-gray-700 text-sm font-bold mb-2"),c(T,"for","serviceSleepTime"),c(p,"id","storeRetryBackoff"),c(p,"placeholder","Back Off (ms)"),c(p,"type","number"),c(p,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),c(w,"class","w-full"),c(e,"class","flex flex-col w-full gap-2.5")},m(_,b){J(_,e,b),a(e,t),a(t,r),a(e,n),a(e,s),a(s,o),a(o,i),a(s,u),a(s,f),K(f,l[0]),a(e,E),a(e,w),a(w,T),a(T,A),a(w,m),a(w,p),K(p,l[1]),R||(F=[O(f,"input",l[3]),O(f,"change",l[2]),O(p,"input",l[4]),O(p,"change",l[2])],R=!0)},p(_,[b]){b&1&&U(f.value)!==_[0]&&K(f,_[0]),b&2&&U(p.value)!==_[1]&&K(p,_[1])},i:le,o:le,d(_){_&&d(e),R=!1,be(F)}}}function ct(l,e,t){let r=He(),n=r.retryCount,s=r.retryBackoffTime;function o(){r.retryCount=U(n),r.retryBackoffTime=U(s),Ke(r)}function i(){n=U(this.value),t(0,n)}function u(){s=U(this.value),t(1,s)}return[n,s,o,i,u]}class ft extends ue{constructor(e){super(),ce(this,e,ct,ut,fe,{})}}function Se(l){let e,t,r,n,s,o,i,u,f,E,w,T,A;return{c(){e=h("div"),t=h("div"),r=h("p"),n=S(l[0]),s=$(),o=h("div"),i=h("button"),u=S("info"),f=$(),E=h("button"),w=S("delete"),this.h()},l(m){e=g(m,"DIV",{class:!0});var p=v(e);t=g(p,"DIV",{class:!0});var R=v(t);r=g(R,"P",{class:!0});var F=v(r);n=x(F,l[0]),F.forEach(d),R.forEach(d),s=I(p),o=g(p,"DIV",{class:!0});var _=v(o);i=g(_,"BUTTON",{class:!0});var b=v(i);u=x(b,"info"),b.forEach(d),f=I(_),E=g(_,"BUTTON",{class:!0});var P=v(E);w=x(P,"delete"),P.forEach(d),_.forEach(d),p.forEach(d),this.h()},h(){c(r,"class","text-xl"),c(t,"class","flex flex-row gap-2.5"),i.disabled=!0,c(i,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),c(E,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),c(o,"class","flex flex-row gap-2.5"),c(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(m,p){J(m,e,p),a(e,t),a(t,r),a(r,n),a(e,s),a(e,o),a(o,i),a(i,u),a(o,f),a(o,E),a(E,w),T||(A=O(E,"click",l[3]),T=!0)},p(m,p){p&1&&Je(n,m[0])},d(m){m&&d(e),T=!1,A()}}}function dt(l){let e,t=l[0]&&Se(l);return{c(){t&&t.c(),e=ie()},l(r){t&&t.l(r),e=ie()},m(r,n){t&&t.m(r,n),J(r,e,n)},p(r,[n]){r[0]?t?t.p(r,n):(t=Se(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:le,o:le,d(r){t&&t.d(r),r&&d(e)}}}function pt(l,e,t){let r,{todo:n}=e,s=nt({onSuccessFn:i=>{te.push(`Cleared ${i} 🗑️`)},onErrorFn:()=>{te.push("Error occured deleting 😔")}});ae(l,s,i=>t(1,r=i));const o=()=>r.mutate(n);return l.$$set=i=>{"todo"in i&&t(0,n=i.todo)},[n,r,s,o]}class ht extends ue{constructor(e){super(),ce(this,e,pt,dt,fe,{todo:0})}}function xe(l,e,t){const r=l.slice();return r[11]=e[t],r}function Ae(l){let e,t;return{c(){e=h("p"),t=S("Adder Loading,")},l(r){e=g(r,"P",{});var n=v(e);t=x(n,"Adder Loading,"),n.forEach(d)},m(r,n){J(r,e,n),a(e,t)},d(r){r&&d(e)}}}function Le(l){let e,t;return{c(){e=h("p"),t=S("Error Adding,")},l(r){e=g(r,"P",{});var n=v(e);t=x(n,"Error Adding,"),n.forEach(d)},m(r,n){J(r,e,n),a(e,t)},d(r){r&&d(e)}}}function gt(l){let e,t;return{c(){e=h("p"),t=S("Waiting For Input...")},l(r){e=g(r,"P",{});var n=v(e);t=x(n,"Waiting For Input..."),n.forEach(d)},m(r,n){J(r,e,n),a(e,t)},d(r){r&&d(e)}}}function mt(l){let e,t;return{c(){e=h("p"),t=S("Fetching Items,")},l(r){e=g(r,"P",{});var n=v(e);t=x(n,"Fetching Items,"),n.forEach(d)},m(r,n){J(r,e,n),a(e,t)},d(r){r&&d(e)}}}function Ce(l){let e,t;return{c(){e=h("p"),t=S("Error Occured Fetching - Retrying")},l(r){e=g(r,"P",{});var n=v(e);t=x(n,"Error Occured Fetching - Retrying"),n.forEach(d)},m(r,n){J(r,e,n),a(e,t)},d(r){r&&d(e)}}}function Me(l){let e,t,r=l[2].data,n=[];for(let o=0;o<r.length;o+=1)n[o]=Re(xe(l,r,o));const s=o=>Y(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ie()},l(o){for(let i=0;i<n.length;i+=1)n[i].l(o);e=ie()},m(o,i){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(o,i);J(o,e,i),t=!0},p(o,i){if(i&4){r=o[2].data;let u;for(u=0;u<r.length;u+=1){const f=xe(o,r,u);n[u]?(n[u].p(f,i),j(n[u],1)):(n[u]=Re(f),n[u].c(),j(n[u],1),n[u].m(e.parentNode,e))}for(Ve(),u=r.length;u<n.length;u+=1)s(u);Be()}},i(o){if(!t){for(let i=0;i<r.length;i+=1)j(n[i]);t=!0}},o(o){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)Y(n[i]);t=!1},d(o){qe(n,o),o&&d(e)}}}function Re(l){let e,t;return e=new ht({props:{todo:l[11]}}),{c(){ge(e.$$.fragment)},l(r){me(e.$$.fragment,r)},m(r,n){_e(e,r,n),t=!0},p(r,n){const s={};n&4&&(s.todo=r[11]),e.$set(s)},i(r){t||(j(e.$$.fragment,r),t=!0)},o(r){Y(e.$$.fragment,r),t=!1},d(r){ve(e,r)}}}function _t(l){let e,t,r,n,s,o,i,u,f,E,w,T,A,m,p,R,F,_,b,P,B,q,V,W,X,ne,he,we;r=new st({}),s=new ft({});let L=l[1].isLoading&&Ae(),C=l[1].isError&&Le();function Fe(y,N){if(y[2].isLoading)return mt;if(!y[2].isError)return gt}let ee=Fe(l),D=ee&&ee(l),M=l[2].isError&&Ce(),k=l[2].data&&l[2].data.length>0&&Me(l);return{c(){e=h("div"),t=h("div"),ge(r.$$.fragment),n=$(),ge(s.$$.fragment),o=$(),i=h("div"),u=h("input"),f=$(),E=h("button"),w=S("Add Item"),A=$(),m=h("button"),p=S("Clear All"),R=$(),F=h("div"),_=h("p"),b=S("Current Status:"),P=$(),L&&L.c(),B=$(),C&&C.c(),q=$(),D&&D.c(),V=$(),M&&M.c(),W=$(),X=h("div"),k&&k.c(),this.h()},l(y){e=g(y,"DIV",{class:!0});var N=v(e);t=g(N,"DIV",{class:!0});var oe=v(t);me(r.$$.fragment,oe),n=I(oe),me(s.$$.fragment,oe),oe.forEach(d),o=I(N),i=g(N,"DIV",{class:!0});var Q=v(i);u=g(Q,"INPUT",{placeholder:!0,type:!0,class:!0}),f=I(Q),E=g(Q,"BUTTON",{class:!0});var Te=v(E);w=x(Te,"Add Item"),Te.forEach(d),A=I(Q),m=g(Q,"BUTTON",{class:!0});var ke=v(m);p=x(ke,"Clear All"),ke.forEach(d),R=I(Q),F=g(Q,"DIV",{class:!0});var H=v(F);_=g(H,"P",{});var $e=v(_);b=x($e,"Current Status:"),$e.forEach(d),P=I(H),L&&L.l(H),B=I(H),C&&C.l(H),q=I(H),D&&D.l(H),V=I(H),M&&M.l(H),H.forEach(d),Q.forEach(d),W=I(N),X=g(N,"DIV",{class:!0});var Ie=v(X);k&&k.l(Ie),Ie.forEach(d),N.forEach(d),this.h()},h(){c(t,"class","flex flex-row gap-5 w-full"),c(u,"placeholder","Item"),c(u,"type","text"),c(u,"class","shadow appearance-none border rounded px-3 py-2 text-gray"),E.disabled=T=l[1].isLoading||!l[0],c(E,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),c(m,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),c(F,"class","flex flex-row gap-1"),c(i,"class","flex flex-row gap-2.5 items-center w-full"),c(X,"class","flex flex-col gap-2.5"),c(e,"class","flex flex-col gap-5 p-10 items-center")},m(y,N){J(y,e,N),a(e,t),_e(r,t,null),a(t,n),_e(s,t,null),a(e,o),a(e,i),a(i,u),K(u,l[0]),a(i,f),a(i,E),a(E,w),a(i,A),a(i,m),a(m,p),a(i,R),a(i,F),a(F,_),a(_,b),a(F,P),L&&L.m(F,null),a(F,B),C&&C.m(F,null),a(F,q),D&&D.m(F,null),a(F,V),M&&M.m(F,null),a(e,W),a(e,X),k&&k.m(X,null),ne=!0,he||(we=[O(u,"input",l[9]),O(u,"keyup",l[8]),O(E,"click",l[6]),O(m,"click",l[7])],he=!0)},p(y,[N]){N&1&&u.value!==y[0]&&K(u,y[0]),(!ne||N&3&&T!==(T=y[1].isLoading||!y[0]))&&(E.disabled=T),y[1].isLoading?L||(L=Ae(),L.c(),L.m(F,B)):L&&(L.d(1),L=null),y[1].isError?C||(C=Le(),C.c(),C.m(F,q)):C&&(C.d(1),C=null),ee!==(ee=Fe(y))&&(D&&D.d(1),D=ee&&ee(y),D&&(D.c(),D.m(F,V))),y[2].isError?M||(M=Ce(),M.c(),M.m(F,null)):M&&(M.d(1),M=null),y[2].data&&y[2].data.length>0?k?(k.p(y,N),N&4&&j(k,1)):(k=Me(y),k.c(),j(k,1),k.m(X,null)):k&&(Ve(),Y(k,1,1,()=>{k=null}),Be())},i(y){ne||(j(r.$$.fragment,y),j(s.$$.fragment,y),j(k),ne=!0)},o(y){Y(r.$$.fragment,y),Y(s.$$.fragment,y),Y(k),ne=!1},d(y){y&&d(e),ve(r),ve(s),L&&L.d(),C&&C.d(),D&&D.d(),M&&M.d(),k&&k.d(),he=!1,be(we)}}}function vt(l,e,t){let r,n,s,o=rt();ae(l,o,m=>t(2,s=m));let i=ot({onSuccessFn:()=>{te.push("Cleared All 🗑️")},onErrorFn:()=>{te.push("Error occured clearing all 😔")}});ae(l,i,m=>t(10,r=m));let u=lt({onSuccessFn:m=>{te.push(`${m} Added 😊`)},onErrorFn:()=>{te.push("Error ocurred adding 😔")}});ae(l,u,m=>t(1,n=m));let f="";function E(){!f||n.isLoading||(n.mutate(f),t(0,f=""))}function w(){r.mutate()}function T(m){m.key==="Enter"&&E()}function A(){f=this.value,t(0,f)}return[f,n,s,o,i,u,E,w,T,A]}class Ft extends ue{constructor(e){super(),ce(this,e,vt,_t,fe,{})}}export{Ft as component};
