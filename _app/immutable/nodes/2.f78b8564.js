var ut=Object.defineProperty;var ct=(l,e,r)=>e in l?ut(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r;var ie=(l,e,r)=>(ct(l,typeof e!="symbol"?e+"":e,r),r);import{J as dt,S as ft,i as pt,s as ht,k as s,q as w,a as _,l as u,m as d,r as k,h as i,c as m,n,b as ee,G as a,K as G,L as A,M as H,H as ze,N as gt,I as Xe,e as Ye,O as bt,u as vt}from"../chunks/index.826d2e79.js";import{w as at}from"../chunks/index.afe0d78c.js";const _t=5,mt=500;let ot={retryCount:5,retryBackoffTime:100};function yt(){return ot}function Et(l){ot=l}const se=new Map;function wt(l,e){const r=se.get(l);if(r)return nt(l),r.store;console.log(`creating: ${l}`);const t=It(e);return se.set(l,t),De(t,e),se.get(l).store}function De(l,e,r=0){console.log("executing fn"),r<_t&&e().then(t=>Lt(l,t)).catch(()=>{l.store.update(t=>(t.isError=!0,t)),r=r+1,console.log(`retry: ${r}`),setTimeout(()=>{De(l,e,r)},r*mt)})}function nt(l){if(console.log(`refreshing: ${l}`),!se.has(l))return;const e=se.get(l);e.store.update(r=>(r.isLoading=!0,r)),De(e,e.function)}class kt{constructor(e,r,t){ie(this,"key");ie(this,"fn");ie(this,"optimisticMutateFn");ie(this,"isLoading",!1);ie(this,"isError",!1);this.key=e,this.fn=r,this.optimisticMutateFn=t}mutate(...e){console.log(e),this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const r=se.get(this.key),t=dt(r.store).data,o=JSON.parse(JSON.stringify(t));if(this.optimisticMutateFn&&t){const p=this.optimisticMutateFn(t,e);r.store.update(c=>(c.data=p,c))}this.fn(...e).then(()=>{r&&nt(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&r.store.update(p=>(p.data=o,p))}).finally(()=>{this.isLoading=!1})}}function Tt(l,e,r){const t=new kt(l,e,r);return at(t)}function It(l){return{function:l,store:at({isLoading:!0,isError:!1,data:void 0})}}function Lt(l,e){return l.store.update(r=>(r.isLoading=!1,r.isError=!1,r.data=e,r)),l}async function it(l){return new Promise(e=>setTimeout(e,l*1e3))}let ye=[],ce={failureRate:.5,sleepTime:.25};function Rt(){return ce}function Ct(l){ce=l}async function St(){if(await it(ce.sleepTime),st())throw new Error("unable to get");return console.log("service: get"),console.log(ye),JSON.parse(JSON.stringify(ye))}async function Vt(l){if(await it(ce.sleepTime),st())throw new Error("unable to add");return ye.push(l),console.log("service: add"),console.log(ye),!0}function st(){return Math.random()<ce.failureRate}function Ft(){return wt("todos",St)}function xt(){return Tt("todos",Vt,(l,e)=>{if(l)return l.push(e),l})}function Bt(){}function Ze(l,e,r){const t=l.slice();return t[21]=e[r],t}function $e(l){let e,r;return{c(){e=s("p"),r=w("Adder Loading,")},l(t){e=u(t,"P",{});var o=d(e);r=k(o,"Adder Loading,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,r)},d(t){t&&i(e)}}}function et(l){let e,r;return{c(){e=s("p"),r=w("Error Adding,")},l(t){e=u(t,"P",{});var o=d(e);r=k(o,"Error Adding,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,r)},d(t){t&&i(e)}}}function Nt(l){let e,r;return{c(){e=s("p"),r=w("Waiting For Input...")},l(t){e=u(t,"P",{});var o=d(e);r=k(o,"Waiting For Input..."),o.forEach(i)},m(t,o){ee(t,e,o),a(e,r)},d(t){t&&i(e)}}}function At(l){let e,r;return{c(){e=s("p"),r=w("Fetching Items,")},l(t){e=u(t,"P",{});var o=d(e);r=k(o,"Fetching Items,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,r)},d(t){t&&i(e)}}}function tt(l){let e,r;return{c(){e=s("p"),r=w("Error Occured Fetching - Retrying")},l(t){e=u(t,"P",{});var o=d(e);r=k(o,"Error Occured Fetching - Retrying"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,r)},d(t){t&&i(e)}}}function lt(l){let e,r=l[6].data,t=[];for(let o=0;o<r.length;o+=1)t[o]=rt(Ze(l,r,o));return{c(){for(let o=0;o<t.length;o+=1)t[o].c();e=Ye()},l(o){for(let p=0;p<t.length;p+=1)t[p].l(o);e=Ye()},m(o,p){for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(o,p);ee(o,e,p)},p(o,p){if(p&64){r=o[6].data;let c;for(c=0;c<r.length;c+=1){const h=Ze(o,r,c);t[c]?t[c].p(h,p):(t[c]=rt(h),t[c].c(),t[c].m(e.parentNode,e))}for(;c<t.length;c+=1)t[c].d(1);t.length=r.length}},d(o){bt(t,o),o&&i(e)}}}function rt(l){let e,r,t,o=l[21]+"",p,c,h,v,D,M,g,Q,I,x,N;function X(){return l[18](l[21])}return{c(){e=s("div"),r=s("div"),t=s("p"),p=w(o),c=_(),h=s("div"),v=s("button"),D=w("info"),M=_(),g=s("button"),Q=w("delete"),I=_(),this.h()},l(b){e=u(b,"DIV",{class:!0});var L=d(e);r=u(L,"DIV",{class:!0});var R=d(r);t=u(R,"P",{class:!0});var q=d(t);p=k(q,o),q.forEach(i),R.forEach(i),c=m(L),h=u(L,"DIV",{class:!0});var W=d(h);v=u(W,"BUTTON",{class:!0});var Y=d(v);D=k(Y,"info"),Y.forEach(i),M=m(W),g=u(W,"BUTTON",{class:!0});var O=d(g);Q=k(O,"delete"),O.forEach(i),W.forEach(i),I=m(L),L.forEach(i),this.h()},h(){n(t,"class","text-xl"),n(r,"class","flex flex-row gap-2.5"),v.disabled=!0,n(v,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),n(g,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),n(h,"class","flex flex-row gap-2.5"),n(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(b,L){ee(b,e,L),a(e,r),a(r,t),a(t,p),a(e,c),a(e,h),a(h,v),a(v,D),a(h,M),a(h,g),a(g,Q),a(e,I),x||(N=A(g,"click",X),x=!0)},p(b,L){l=b,L&64&&o!==(o=l[21]+"")&&vt(p,o)},d(b){b&&i(e),x=!1,N()}}}function Dt(l){let e,r,t,o,p,c,h,v,D,M,g,Q,I,x,N,X,b,L,R,q,W,Y,O,C,Ee,we,P,ke,Z,te,Te,Ie,U,Le,J,K,Re,z,Ce,de,Se,le,Ve,Fe,y,ue,xe,Be,fe,pe,he,Ne,re,Ae,Me,S=l[5].isLoading&&$e(),V=l[5].isError&&et();function Oe(f,E){if(f[6].isLoading)return At;if(!f[6].isError)return Nt}let ae=Oe(l),B=ae&&ae(l),F=l[6].isError&&tt(),T=l[6].data&&l[6].data.length>0&&lt(l);return{c(){e=s("div"),r=s("div"),t=s("div"),o=s("h3"),p=w("Service Configuration"),c=_(),h=s("div"),v=s("label"),D=w("Failure Rate"),M=_(),g=s("input"),Q=_(),I=s("div"),x=s("label"),N=w("Sleep Time (ms)"),X=_(),b=s("input"),L=_(),R=s("div"),q=s("h3"),W=w("Store Configuration"),Y=_(),O=s("div"),C=s("label"),Ee=w("Retry Count"),we=_(),P=s("input"),ke=_(),Z=s("div"),te=s("label"),Te=w("Retry Back Off (ms)"),Ie=_(),U=s("input"),Le=_(),J=s("div"),K=s("input"),Re=_(),z=s("button"),Ce=w("Add Item"),Se=_(),le=s("button"),Ve=w("Clear All"),Fe=_(),y=s("div"),ue=s("p"),xe=w("Current Status:"),Be=_(),S&&S.c(),fe=_(),V&&V.c(),pe=_(),B&&B.c(),he=_(),F&&F.c(),Ne=_(),re=s("div"),T&&T.c(),this.h()},l(f){e=u(f,"DIV",{class:!0});var E=d(e);r=u(E,"DIV",{class:!0});var ge=d(r);t=u(ge,"DIV",{class:!0});var oe=d(t);o=u(oe,"H3",{class:!0});var Pe=d(o);p=k(Pe,"Service Configuration"),Pe.forEach(i),c=m(oe),h=u(oe,"DIV",{class:!0});var be=d(h);v=u(be,"LABEL",{class:!0,for:!0});var Ue=d(v);D=k(Ue,"Failure Rate"),Ue.forEach(i),M=m(be),g=u(be,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),be.forEach(i),Q=m(oe),I=u(oe,"DIV",{class:!0});var ve=d(I);x=u(ve,"LABEL",{class:!0,for:!0});var Je=d(x);N=k(Je,"Sleep Time (ms)"),Je.forEach(i),X=m(ve),b=u(ve,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),ve.forEach(i),oe.forEach(i),L=m(ge),R=u(ge,"DIV",{class:!0});var ne=d(R);q=u(ne,"H3",{class:!0});var He=d(q);W=k(He,"Store Configuration"),He.forEach(i),Y=m(ne),O=u(ne,"DIV",{class:!0});var _e=d(O);C=u(_e,"LABEL",{class:!0,for:!0});var qe=d(C);Ee=k(qe,"Retry Count"),qe.forEach(i),we=m(_e),P=u(_e,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),_e.forEach(i),ke=m(ne),Z=u(ne,"DIV",{class:!0});var me=d(Z);te=u(me,"LABEL",{class:!0,for:!0});var Ke=d(te);Te=k(Ke,"Retry Back Off (ms)"),Ke.forEach(i),Ie=m(me),U=u(me,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),me.forEach(i),ne.forEach(i),ge.forEach(i),Le=m(E),J=u(E,"DIV",{class:!0});var $=d(J);K=u($,"INPUT",{placeholder:!0,type:!0,class:!0}),Re=m($),z=u($,"BUTTON",{class:!0});var We=d(z);Ce=k(We,"Add Item"),We.forEach(i),Se=m($),le=u($,"BUTTON",{class:!0});var je=d(le);Ve=k(je,"Clear All"),je.forEach(i),Fe=m($),y=u($,"DIV",{class:!0});var j=d(y);ue=u(j,"P",{});var Ge=d(ue);xe=k(Ge,"Current Status:"),Ge.forEach(i),Be=m(j),S&&S.l(j),fe=m(j),V&&V.l(j),pe=m(j),B&&B.l(j),he=m(j),F&&F.l(j),j.forEach(i),$.forEach(i),Ne=m(E),re=u(E,"DIV",{class:!0});var Qe=d(re);T&&T.l(Qe),Qe.forEach(i),E.forEach(i),this.h()},h(){n(o,"class","text-xl"),n(v,"class","block text-gray-700 text-sm font-bold mb-2"),n(v,"for","serviceFailureRate"),n(g,"id","serviceFailureRate"),n(g,"placeholder","Failure Rate"),n(g,"type","number"),n(g,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(h,"class","w-full"),n(x,"class","block text-gray-700 text-sm font-bold mb-2"),n(x,"for","serviceSleepTime"),n(b,"id","serviceSleepTime"),n(b,"placeholder","Sleep Time"),n(b,"type","number"),n(b,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(I,"class","w-full"),n(t,"class","flex flex-col w-full gap-2.5"),n(q,"class","text-xl"),n(C,"class","block text-gray-700 text-sm font-bold mb-2"),n(C,"for","storeRetryCount"),n(P,"id","storeRetryCount"),n(P,"placeholder","Retry Count"),n(P,"type","number"),n(P,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(O,"class","w-full"),n(te,"class","block text-gray-700 text-sm font-bold mb-2"),n(te,"for","serviceSleepTime"),n(U,"id","storeRetryBackoff"),n(U,"placeholder","Back Off (ms)"),n(U,"type","number"),n(U,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(Z,"class","w-full"),n(R,"class","flex flex-col w-full gap-2.5"),n(r,"class","flex flex-row gap-5 w-full"),n(K,"placeholder","Item"),n(K,"type","text"),n(K,"class","shadow appearance-none border rounded px-3 py-2 text-gray"),z.disabled=de=l[5].isLoading||!l[4],n(z,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),n(le,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),n(y,"class","flex flex-row gap-1"),n(J,"class","flex flex-row gap-2.5 items-center w-full"),n(re,"class","flex flex-col gap-2.5"),n(e,"class","flex flex-col gap-5 p-10 items-center")},m(f,E){ee(f,e,E),a(e,r),a(r,t),a(t,o),a(o,p),a(t,c),a(t,h),a(h,v),a(v,D),a(h,M),a(h,g),G(g,l[0]),a(t,Q),a(t,I),a(I,x),a(x,N),a(I,X),a(I,b),G(b,l[1]),a(r,L),a(r,R),a(R,q),a(q,W),a(R,Y),a(R,O),a(O,C),a(C,Ee),a(O,we),a(O,P),G(P,l[2]),a(R,ke),a(R,Z),a(Z,te),a(te,Te),a(Z,Ie),a(Z,U),G(U,l[3]),a(e,Le),a(e,J),a(J,K),G(K,l[4]),a(J,Re),a(J,z),a(z,Ce),a(J,Se),a(J,le),a(le,Ve),a(J,Fe),a(J,y),a(y,ue),a(ue,xe),a(y,Be),S&&S.m(y,null),a(y,fe),V&&V.m(y,null),a(y,pe),B&&B.m(y,null),a(y,he),F&&F.m(y,null),a(e,Ne),a(e,re),T&&T.m(re,null),Ae||(Me=[A(g,"input",l[13]),A(g,"change",l[7]),A(b,"input",l[14]),A(b,"change",l[7]),A(P,"input",l[15]),A(P,"change",l[8]),A(U,"input",l[16]),A(U,"change",l[8]),A(K,"input",l[17]),A(K,"keyup",l[12]),A(z,"click",l[11]),A(le,"click",Bt)],Ae=!0)},p(f,[E]){E&1&&H(g.value)!==f[0]&&G(g,f[0]),E&2&&H(b.value)!==f[1]&&G(b,f[1]),E&4&&H(P.value)!==f[2]&&G(P,f[2]),E&8&&H(U.value)!==f[3]&&G(U,f[3]),E&16&&K.value!==f[4]&&G(K,f[4]),E&48&&de!==(de=f[5].isLoading||!f[4])&&(z.disabled=de),f[5].isLoading?S||(S=$e(),S.c(),S.m(y,fe)):S&&(S.d(1),S=null),f[5].isError?V||(V=et(),V.c(),V.m(y,pe)):V&&(V.d(1),V=null),ae!==(ae=Oe(f))&&(B&&B.d(1),B=ae&&ae(f),B&&(B.c(),B.m(y,he))),f[6].isError?F||(F=tt(),F.c(),F.m(y,null)):F&&(F.d(1),F=null),f[6].data&&f[6].data.length>0?T?T.p(f,E):(T=lt(f),T.c(),T.m(re,null)):T&&(T.d(1),T=null)},i:ze,o:ze,d(f){f&&i(e),S&&S.d(),V&&V.d(),B&&B.d(),F&&F.d(),T&&T.d(),Ae=!1,gt(Me)}}}function Mt(l,e,r){let t,o,p=Rt(),c=p.failureRate,h=p.sleepTime,v=yt(),D=v.retryCount,M=v.retryBackoffTime;function g(){p.failureRate=H(c),p.sleepTime=H(h),Ct(p)}function Q(){v.retryCount=H(D),v.retryBackoffTime=H(M),Et(v)}let I=Ft();Xe(l,I,C=>r(6,o=C));let x=xt();Xe(l,x,C=>r(5,t=C));let N="";function X(){N&&(t.mutate(N),r(4,N=""))}function b(C){console.log(C),C.key==="Enter"&&X()}function L(){c=H(this.value),r(0,c)}function R(){h=H(this.value),r(1,h)}function q(){D=H(this.value),r(2,D)}function W(){M=H(this.value),r(3,M)}function Y(){N=this.value,r(4,N)}return[c,h,D,M,N,t,o,g,Q,I,x,X,b,L,R,q,W,Y,C=>void 0]}class Jt extends ft{constructor(e){super(),pt(this,e,Mt,Dt,ht,{})}}export{Jt as component};
