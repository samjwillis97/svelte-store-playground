var ut=Object.defineProperty;var ct=(r,e,l)=>e in r?ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[e]=l;var ie=(r,e,l)=>(ct(r,typeof e!="symbol"?e+"":e,l),l);import{J as dt,S as ft,i as pt,s as ht,k as s,q as w,a as _,l as u,m as d,r as k,h as i,c as m,n,b as ee,G as a,K as G,L as A,M as H,H as ze,N as gt,I as Xe,e as Ye,O as vt,u as bt}from"../chunks/index.826d2e79.js";import{w as at}from"../chunks/index.afe0d78c.js";const _t=5,mt=500;let ot={retryCount:5,retryBackoffTime:100};function yt(){return ot}function Et(r){ot=r}const se=new Map;function wt(r,e){const l=se.get(r);if(l)return nt(r),l.store;console.log(`creating: ${r}`);const t=It(e);return se.set(r,t),De(t,e),se.get(r).store}function De(r,e,l=0){console.log("executing fn"),l<_t&&e().then(t=>Lt(r,t)).catch(()=>{r.store.update(t=>(t.isError=!0,t)),l=l+1,console.log(`retry: ${l}`),setTimeout(()=>{De(r,e,l)},l*mt)})}function nt(r){if(console.log(`refreshing: ${r}`),!se.has(r))return;const e=se.get(r);e.store.update(l=>(l.isLoading=!0,l)),De(e,e.function)}class kt{constructor(e,l,t){ie(this,"key");ie(this,"fn");ie(this,"optimisticMutateFn");ie(this,"isLoading",!1);ie(this,"isError",!1);this.key=e,this.fn=l,this.optimisticMutateFn=t}mutate(...e){console.log(e),this.isLoading=!0,this.isError=!1,console.log(`mutating v2 ${this.key}`);const l=se.get(this.key),t=dt(l.store).data,o=JSON.parse(JSON.stringify(t));if(this.optimisticMutateFn&&t){const p=this.optimisticMutateFn(t,...e);l.store.update(c=>(c.data=p,c))}this.fn(...e).then(()=>{l&&nt(this.key),this.isLoading=!1}).catch(()=>{this.isError=!0,this.isLoading=!1,console.log(`error mutating: ${this.key}`),this.optimisticMutateFn&&l.store.update(p=>(p.data=o,p))}).finally(()=>{this.isLoading=!1})}}function Tt(r,e,l){const t=new kt(r,e,l);return at(t)}function It(r){return{function:r,store:at({isLoading:!0,isError:!1,data:void 0})}}function Lt(r,e){return r.store.update(l=>(l.isLoading=!1,l.isError=!1,l.data=e,l)),r}async function it(r){return new Promise(e=>setTimeout(e,r*1e3))}let ye=[],ce={failureRate:.5,sleepTime:.25};function Rt(){return ce}function Ct(r){ce=r}async function St(){if(await it(ce.sleepTime),st())throw new Error("unable to get");return console.log("service: get"),console.log(ye),JSON.parse(JSON.stringify(ye))}async function Vt(r){if(await it(ce.sleepTime),st())throw new Error("unable to add");return ye.push(r),console.log("service: add"),console.log(ye),!0}function st(){return Math.random()<ce.failureRate}function Ft(){return wt("todos",St)}function xt(){return Tt("todos",Vt,(r,e)=>(r.push(e),r))}function Bt(){}function Ze(r,e,l){const t=r.slice();return t[21]=e[l],t}function $e(r){let e,l;return{c(){e=s("p"),l=w("Adder Loading,")},l(t){e=u(t,"P",{});var o=d(e);l=k(o,"Adder Loading,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,l)},d(t){t&&i(e)}}}function et(r){let e,l;return{c(){e=s("p"),l=w("Error Adding,")},l(t){e=u(t,"P",{});var o=d(e);l=k(o,"Error Adding,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,l)},d(t){t&&i(e)}}}function Nt(r){let e,l;return{c(){e=s("p"),l=w("Waiting For Input...")},l(t){e=u(t,"P",{});var o=d(e);l=k(o,"Waiting For Input..."),o.forEach(i)},m(t,o){ee(t,e,o),a(e,l)},d(t){t&&i(e)}}}function At(r){let e,l;return{c(){e=s("p"),l=w("Fetching Items,")},l(t){e=u(t,"P",{});var o=d(e);l=k(o,"Fetching Items,"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,l)},d(t){t&&i(e)}}}function tt(r){let e,l;return{c(){e=s("p"),l=w("Error Occured Fetching - Retrying")},l(t){e=u(t,"P",{});var o=d(e);l=k(o,"Error Occured Fetching - Retrying"),o.forEach(i)},m(t,o){ee(t,e,o),a(e,l)},d(t){t&&i(e)}}}function lt(r){let e,l=r[6].data,t=[];for(let o=0;o<l.length;o+=1)t[o]=rt(Ze(r,l,o));return{c(){for(let o=0;o<t.length;o+=1)t[o].c();e=Ye()},l(o){for(let p=0;p<t.length;p+=1)t[p].l(o);e=Ye()},m(o,p){for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(o,p);ee(o,e,p)},p(o,p){if(p&64){l=o[6].data;let c;for(c=0;c<l.length;c+=1){const h=Ze(o,l,c);t[c]?t[c].p(h,p):(t[c]=rt(h),t[c].c(),t[c].m(e.parentNode,e))}for(;c<t.length;c+=1)t[c].d(1);t.length=l.length}},d(o){vt(t,o),o&&i(e)}}}function rt(r){let e,l,t,o=r[21]+"",p,c,h,b,D,M,g,Q,I,F,N;function X(){return r[18](r[21])}return{c(){e=s("div"),l=s("div"),t=s("p"),p=w(o),c=_(),h=s("div"),b=s("button"),D=w("info"),M=_(),g=s("button"),Q=w("delete"),I=_(),this.h()},l(v){e=u(v,"DIV",{class:!0});var L=d(e);l=u(L,"DIV",{class:!0});var R=d(l);t=u(R,"P",{class:!0});var q=d(t);p=k(q,o),q.forEach(i),R.forEach(i),c=m(L),h=u(L,"DIV",{class:!0});var W=d(h);b=u(W,"BUTTON",{class:!0});var Y=d(b);D=k(Y,"info"),Y.forEach(i),M=m(W),g=u(W,"BUTTON",{class:!0});var O=d(g);Q=k(O,"delete"),O.forEach(i),W.forEach(i),I=m(L),L.forEach(i),this.h()},h(){n(t,"class","text-xl"),n(l,"class","flex flex-row gap-2.5"),b.disabled=!0,n(b,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 disabled:bg-blue-200"),n(g,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disabled:bg-red-200"),n(h,"class","flex flex-row gap-2.5"),n(e,"class","w-96 border shadow rounded px-5 py-5 flex flex-row gap-2.5 justify-between items-center")},m(v,L){ee(v,e,L),a(e,l),a(l,t),a(t,p),a(e,c),a(e,h),a(h,b),a(b,D),a(h,M),a(h,g),a(g,Q),a(e,I),F||(N=A(g,"click",X),F=!0)},p(v,L){r=v,L&64&&o!==(o=r[21]+"")&&bt(p,o)},d(v){v&&i(e),F=!1,N()}}}function Dt(r){let e,l,t,o,p,c,h,b,D,M,g,Q,I,F,N,X,v,L,R,q,W,Y,O,x,Ee,we,P,ke,Z,te,Te,Ie,U,Le,J,K,Re,z,Ce,de,Se,le,Ve,Fe,y,ue,xe,Be,fe,pe,he,Ne,re,Ae,Me,C=r[5].isLoading&&$e(),S=r[5].isError&&et();function Oe(f,E){if(f[6].isLoading)return At;if(!f[6].isError)return Nt}let ae=Oe(r),B=ae&&ae(r),V=r[6].isError&&tt(),T=r[6].data&&r[6].data.length>0&&lt(r);return{c(){e=s("div"),l=s("div"),t=s("div"),o=s("h3"),p=w("Service Configuration"),c=_(),h=s("div"),b=s("label"),D=w("Failure Rate"),M=_(),g=s("input"),Q=_(),I=s("div"),F=s("label"),N=w("Sleep Time (ms)"),X=_(),v=s("input"),L=_(),R=s("div"),q=s("h3"),W=w("Store Configuration"),Y=_(),O=s("div"),x=s("label"),Ee=w("Retry Count"),we=_(),P=s("input"),ke=_(),Z=s("div"),te=s("label"),Te=w("Retry Back Off (ms)"),Ie=_(),U=s("input"),Le=_(),J=s("div"),K=s("input"),Re=_(),z=s("button"),Ce=w("Add Item"),Se=_(),le=s("button"),Ve=w("Clear All"),Fe=_(),y=s("div"),ue=s("p"),xe=w("Current Status:"),Be=_(),C&&C.c(),fe=_(),S&&S.c(),pe=_(),B&&B.c(),he=_(),V&&V.c(),Ne=_(),re=s("div"),T&&T.c(),this.h()},l(f){e=u(f,"DIV",{class:!0});var E=d(e);l=u(E,"DIV",{class:!0});var ge=d(l);t=u(ge,"DIV",{class:!0});var oe=d(t);o=u(oe,"H3",{class:!0});var Pe=d(o);p=k(Pe,"Service Configuration"),Pe.forEach(i),c=m(oe),h=u(oe,"DIV",{class:!0});var ve=d(h);b=u(ve,"LABEL",{class:!0,for:!0});var Ue=d(b);D=k(Ue,"Failure Rate"),Ue.forEach(i),M=m(ve),g=u(ve,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),ve.forEach(i),Q=m(oe),I=u(oe,"DIV",{class:!0});var be=d(I);F=u(be,"LABEL",{class:!0,for:!0});var Je=d(F);N=k(Je,"Sleep Time (ms)"),Je.forEach(i),X=m(be),v=u(be,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),be.forEach(i),oe.forEach(i),L=m(ge),R=u(ge,"DIV",{class:!0});var ne=d(R);q=u(ne,"H3",{class:!0});var He=d(q);W=k(He,"Store Configuration"),He.forEach(i),Y=m(ne),O=u(ne,"DIV",{class:!0});var _e=d(O);x=u(_e,"LABEL",{class:!0,for:!0});var qe=d(x);Ee=k(qe,"Retry Count"),qe.forEach(i),we=m(_e),P=u(_e,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),_e.forEach(i),ke=m(ne),Z=u(ne,"DIV",{class:!0});var me=d(Z);te=u(me,"LABEL",{class:!0,for:!0});var Ke=d(te);Te=k(Ke,"Retry Back Off (ms)"),Ke.forEach(i),Ie=m(me),U=u(me,"INPUT",{id:!0,placeholder:!0,type:!0,class:!0}),me.forEach(i),ne.forEach(i),ge.forEach(i),Le=m(E),J=u(E,"DIV",{class:!0});var $=d(J);K=u($,"INPUT",{placeholder:!0,type:!0,class:!0}),Re=m($),z=u($,"BUTTON",{class:!0});var We=d(z);Ce=k(We,"Add Item"),We.forEach(i),Se=m($),le=u($,"BUTTON",{class:!0});var je=d(le);Ve=k(je,"Clear All"),je.forEach(i),Fe=m($),y=u($,"DIV",{class:!0});var j=d(y);ue=u(j,"P",{});var Ge=d(ue);xe=k(Ge,"Current Status:"),Ge.forEach(i),Be=m(j),C&&C.l(j),fe=m(j),S&&S.l(j),pe=m(j),B&&B.l(j),he=m(j),V&&V.l(j),j.forEach(i),$.forEach(i),Ne=m(E),re=u(E,"DIV",{class:!0});var Qe=d(re);T&&T.l(Qe),Qe.forEach(i),E.forEach(i),this.h()},h(){n(o,"class","text-xl"),n(b,"class","block text-gray-700 text-sm font-bold mb-2"),n(b,"for","serviceFailureRate"),n(g,"id","serviceFailureRate"),n(g,"placeholder","Failure Rate"),n(g,"type","number"),n(g,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(h,"class","w-full"),n(F,"class","block text-gray-700 text-sm font-bold mb-2"),n(F,"for","serviceSleepTime"),n(v,"id","serviceSleepTime"),n(v,"placeholder","Sleep Time"),n(v,"type","number"),n(v,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(I,"class","w-full"),n(t,"class","flex flex-col w-full gap-2.5"),n(q,"class","text-xl"),n(x,"class","block text-gray-700 text-sm font-bold mb-2"),n(x,"for","storeRetryCount"),n(P,"id","storeRetryCount"),n(P,"placeholder","Retry Count"),n(P,"type","number"),n(P,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(O,"class","w-full"),n(te,"class","block text-gray-700 text-sm font-bold mb-2"),n(te,"for","serviceSleepTime"),n(U,"id","storeRetryBackoff"),n(U,"placeholder","Back Off (ms)"),n(U,"type","number"),n(U,"class","w-full shadow appearance-none border rounded px-3 py-2 text-gray"),n(Z,"class","w-full"),n(R,"class","flex flex-col w-full gap-2.5"),n(l,"class","flex flex-row gap-5 w-full"),n(K,"placeholder","Item"),n(K,"type","text"),n(K,"class","shadow appearance-none border rounded px-3 py-2 text-gray"),z.disabled=de=r[5].isLoading||!r[4],n(z,"class","py-2 px-4 rounded text-white bg-blue-500 hover:bg-blue-700 active:bg-blue-800 disabled:bg-blue-200"),n(le,"class","py-2 px-4 rounded text-white bg-red-500 hover:bg-red-700 active:bg-red-800 disable:bg-red-200"),n(y,"class","flex flex-row gap-1"),n(J,"class","flex flex-row gap-2.5 items-center w-full"),n(re,"class","flex flex-col gap-2.5"),n(e,"class","flex flex-col gap-5 p-10 items-center")},m(f,E){ee(f,e,E),a(e,l),a(l,t),a(t,o),a(o,p),a(t,c),a(t,h),a(h,b),a(b,D),a(h,M),a(h,g),G(g,r[0]),a(t,Q),a(t,I),a(I,F),a(F,N),a(I,X),a(I,v),G(v,r[1]),a(l,L),a(l,R),a(R,q),a(q,W),a(R,Y),a(R,O),a(O,x),a(x,Ee),a(O,we),a(O,P),G(P,r[2]),a(R,ke),a(R,Z),a(Z,te),a(te,Te),a(Z,Ie),a(Z,U),G(U,r[3]),a(e,Le),a(e,J),a(J,K),G(K,r[4]),a(J,Re),a(J,z),a(z,Ce),a(J,Se),a(J,le),a(le,Ve),a(J,Fe),a(J,y),a(y,ue),a(ue,xe),a(y,Be),C&&C.m(y,null),a(y,fe),S&&S.m(y,null),a(y,pe),B&&B.m(y,null),a(y,he),V&&V.m(y,null),a(e,Ne),a(e,re),T&&T.m(re,null),Ae||(Me=[A(g,"input",r[13]),A(g,"change",r[7]),A(v,"input",r[14]),A(v,"change",r[7]),A(P,"input",r[15]),A(P,"change",r[8]),A(U,"input",r[16]),A(U,"change",r[8]),A(K,"input",r[17]),A(K,"keyup",r[12]),A(z,"click",r[11]),A(le,"click",Bt)],Ae=!0)},p(f,[E]){E&1&&H(g.value)!==f[0]&&G(g,f[0]),E&2&&H(v.value)!==f[1]&&G(v,f[1]),E&4&&H(P.value)!==f[2]&&G(P,f[2]),E&8&&H(U.value)!==f[3]&&G(U,f[3]),E&16&&K.value!==f[4]&&G(K,f[4]),E&48&&de!==(de=f[5].isLoading||!f[4])&&(z.disabled=de),f[5].isLoading?C||(C=$e(),C.c(),C.m(y,fe)):C&&(C.d(1),C=null),f[5].isError?S||(S=et(),S.c(),S.m(y,pe)):S&&(S.d(1),S=null),ae!==(ae=Oe(f))&&(B&&B.d(1),B=ae&&ae(f),B&&(B.c(),B.m(y,he))),f[6].isError?V||(V=tt(),V.c(),V.m(y,null)):V&&(V.d(1),V=null),f[6].data&&f[6].data.length>0?T?T.p(f,E):(T=lt(f),T.c(),T.m(re,null)):T&&(T.d(1),T=null)},i:ze,o:ze,d(f){f&&i(e),C&&C.d(),S&&S.d(),B&&B.d(),V&&V.d(),T&&T.d(),Ae=!1,gt(Me)}}}function Mt(r,e,l){let t,o,p=Rt(),c=p.failureRate,h=p.sleepTime,b=yt(),D=b.retryCount,M=b.retryBackoffTime;function g(){p.failureRate=H(c),p.sleepTime=H(h),Ct(p)}function Q(){b.retryCount=H(D),b.retryBackoffTime=H(M),Et(b)}let I=Ft();Xe(r,I,x=>l(6,o=x));let F=xt();Xe(r,F,x=>l(5,t=x));let N="";function X(){N&&(t.mutate(N),l(4,N=""))}function v(x){x.key==="Enter"&&X()}function L(){c=H(this.value),l(0,c)}function R(){h=H(this.value),l(1,h)}function q(){D=H(this.value),l(2,D)}function W(){M=H(this.value),l(3,M)}function Y(){N=this.value,l(4,N)}return[c,h,D,M,N,t,o,g,Q,I,F,X,v,L,R,q,W,Y,x=>void 0]}class Jt extends ft{constructor(e){super(),pt(this,e,Mt,Dt,ht,{})}}export{Jt as component};
